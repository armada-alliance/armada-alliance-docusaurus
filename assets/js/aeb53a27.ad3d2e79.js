"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[8210],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return u}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var o=n.createContext({}),c=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},m=function(e){var t=c(e.components);return n.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,l=e.originalType,o=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),p=c(a),u=i,h=p["".concat(o,".").concat(u)]||p[u]||d[u]||l;return a?n.createElement(h,r(r({ref:t},m),{},{components:a})):n.createElement(h,r({ref:t},m))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=a.length,r=new Array(l);r[0]=p;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var c=2;c<l;c++)r[c]=a[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},8965:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return o},default:function(){return u},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return d}});var n=a(7462),i=a(3366),l=(a(7294),a(3905)),r=["components"],s={},o="Apple M1 Asahi Linux",c={unversionedId:"stake-pool-guides/m1-asahi-linux",id:"stake-pool-guides/m1-asahi-linux",title:"Apple M1 Asahi Linux",description:"Prerequisites",source:"@site/docs/stake-pool-guides/m1-asahi-linux.md",sourceDirName:"stake-pool-guides",slug:"/stake-pool-guides/m1-asahi-linux",permalink:"/docs/stake-pool-guides/m1-asahi-linux",draft:!1,editUrl:"https://github.com/armada-alliance/docs/edit/master/docs/stake-pool-guides/m1-asahi-linux.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Apple Silicon",permalink:"/docs/apple-silicon"},next:{title:"Apple M1 macOS",permalink:"/docs/stake-pool-guides/apple-m1-guide/"}},m={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Bash completion",id:"bash-completion",level:2},{value:"Locales",id:"locales",level:2},{value:"Time",id:"time",level:2},{value:"Chrony",id:"chrony",level:2},{value:"Packages",id:"packages",level:2},{value:"zram swap",id:"zram-swap",level:2},{value:"Prometheus",id:"prometheus",level:2},{value:"Grafana",id:"grafana",level:2},{value:"With Snap",id:"with-snap",level:3},{value:"Grafan-bin AUR",id:"grafan-bin-aur",level:3},{value:"Wireguard",id:"wireguard",level:2},{value:"Static ip",id:"static-ip",level:2},{value:"Hostname",id:"hostname",level:2},{value:"Server setup",id:"server-setup",level:2},{value:"sysctl",id:"sysctl",level:2},{value:"Disable the root user",id:"disable-the-root-user",level:3},{value:"Secure shared memory",id:"secure-shared-memory",level:3},{value:"Increase open file limit for $USER",id:"increase-open-file-limit-for-user",level:3},{value:"Environment setup",id:"environment-setup",level:2},{value:"Create bash variables &amp; add ~/.local/bin to our $PATH \ud83c\udfc3",id:"create-bash-variables--add-localbin-to-our-path-",level:3},{value:"Retrieve node files",id:"retrieve-node-files",level:3},{value:"Build Libsodium",id:"build-libsodium",level:2},{value:"Build secp256k1",id:"build-secp256k1",level:2},{value:"LLVM 9.0.1",id:"llvm-901",level:2},{value:"ncurses5 compat libs",id:"ncurses5-compat-libs",level:2},{value:"GHCUP, GHC &amp; Cabal",id:"ghcup-ghc--cabal",level:2},{value:"Obtain cardano-node",id:"obtain-cardano-node",level:3},{value:"Systemd unit startup scripts",id:"systemd-unit-startup-scripts",level:3},{value:"gLiveView.sh",id:"gliveviewsh",level:2},{value:"Install Cronie",id:"install-cronie",level:2},{value:"topologyUpdater.sh (not needed on block producer)",id:"topologyupdatersh-not-needed-on-block-producer",level:2},{value:"Add save and exit",id:"add-save-and-exit",level:3},{value:"Display inbound connections in Grafana",id:"display-inbound-connections-in-grafana",level:2},{value:"System updates",id:"system-updates",level:2},{value:"Usefull links",id:"usefull-links",level:2}],p={toc:d};function u(e){var t=e.components,a=(0,i.Z)(e,r);return(0,l.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"apple-m1-asahi-linux"},"Apple M1 Asahi Linux"),(0,l.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,l.kt)("p",null,"Asahi Arch Linux, minimal or desktop installed on your M1 or M2."),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Allow the installer to use as much space as it can for Asahi"))),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://asahilinux.org/2022/03/asahi-linux-alpha-release/"},"Release Notes")),(0,l.kt)("p",null,"log in to both alarm and root. Change the passwords."),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Desktop version does not have the default alarm user, the user of your choice is setup on first boot. For ease with this guide choose ada as the username. Else pay attention to username when setting up systemd services."))),(0,l.kt)("p",null,"Update the system as root."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"pacman -Syu\n")),(0,l.kt)("p",null,"Start and enable sshd. pw auth is disabled for root, login with alarm user."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"systemctl start sshd.service\nsystemctl enable sshd.service\n")),(0,l.kt)("p",null,"Install pacman-contrib which includes some useful packages and open the sudoers file with visudo and enable the wheel group."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"pacman -S pacman-contrib sudo git curl wget htop rsync numactl\nsudo EDITOR=nano visudo\n")),(0,l.kt)("p",null,"Remove the # like below."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ visudo"',title:'">_','visudo"':!0},"## Uncomment to allow members of group wheel to execute any command\n%wheel ALL=(ALL:ALL) ALL\n\n")),(0,l.kt)("p",null,"Add a new user to the wheel group, give it a password."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"useradd -m -G wheel -s /bin/bash ada\npasswd ada\n")),(0,l.kt)("p",null,"Log out and back in as your new user with SSH. Test sudo by upgrading the system again."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo pacman -Syu\n")),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Remember to copy your ssh key with ssh-copy-id and disable password aurthentication in sshd_config."))),(0,l.kt)("h2",{id:"bash-completion"},"Bash completion"),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"The Arch Bash shell is boring. Optionally install ",(0,l.kt)("a",{parentName:"p",href:"https://bash-it.readthedocs.io/en/latest/installation/"},"Bash-it")," for a fancy shell."))),(0,l.kt)("p",null,"Add 'complete -cf sudo' to the bottom of .bash_profile and source."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"echo complete -cf sudo >> ${HOME}/.bash_profile; . $HOME/.bash_profile\n")),(0,l.kt)("h2",{id:"locales"},"Locales"),(0,l.kt)("p",null,"Generate the ",(0,l.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/locale"},"locales")," by uncommenting (en_US.UTF-8 UTF-8 for example) and generating."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo nano /etc/locale.gen\nsudo locale-gen\nsudo localectl set-locale LANG=en_US.UTF-8\n")),(0,l.kt)("h2",{id:"time"},"Time"),(0,l.kt)("p",null,"Set your timezone"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo timedatectl set-timezone America/New_York\n")),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"No more daylight savings, possible to set RTC to local? testing, might not want to do this."),(0,l.kt)("pre",{parentName:"div"},(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo timedatectl set-local-rtc 1\n# set to 0 for UTC\n")))),(0,l.kt)("h2",{id:"chrony"},"Chrony"),(0,l.kt)("p",null,"While we are messing with time.. Install Chrony and open chrony.conf and replace contents with below (use ctrl+k to cut whole lines)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo pacman -S chrony\nsudo nano /etc/chrony.conf\n")),(0,l.kt)("p",null,"Replace contents of the file with below."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/etc/chrony.conf"',title:'"/etc/chrony.conf"'},"pool time.google.com       iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\npool time.euro.apple.com   iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\npool time.apple.com        iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\npool ntp.ubuntu.com        iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\n\n# This directive specify the location of the file containing ID/key pairs for\n# NTP authentication.\nkeyfile /etc/chrony/chrony.keys\n\n# This directive specify the file into which chronyd will store the rate\n# information.\ndriftfile /var/lib/chrony/chrony.drift\n\n# Uncomment the following line to turn logging on.\n#log tracking measurements statistics\n\n# Log files location.\nlogdir /var/log/chrony\n\n# Stop bad estimates upsetting machine clock.\nmaxupdateskew 5.0\n\n# This directive enables kernel synchronisation (every 11 minutes) of the\n# real-time clock. Note that it can\u2019t be used along with the 'rtcfile' directive.\nrtcsync\n\n# Step the system clock instead of slewing it if the adjustment is larger than\n# one second, but only in the first three clock updates.\nmakestep 0.1 -1\n\n# Get TAI-UTC offset and leap seconds from the system tz database\nleapsectz right/UTC\n\n# Serve time even if not synchronized to a time source.\nlocal stratum 10\n")),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Note: systemd-timesyncd.service is in conflict with chronyd, so you need to disable it first if you want to enable chronyd properly."))),(0,l.kt)("p",null,"Disable systemd-timesyncd and enable Chrony"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo systemctl stop systemd-timesyncd.service\nsudo systemctl disable systemd-timesyncd.service\n# enable and start chrony\nsudo systemctl start chronyd.service\nsudo systemctl enable chronyd.service\n")),(0,l.kt)("h2",{id:"packages"},"Packages"),(0,l.kt)("p",null,"Add the following packages to build and run cardano-node."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo pacman -S --needed base-devel\nsudo pacman -S openssl libtool unzip jq bc xz numactl\n")),(0,l.kt)("h2",{id:"zram-swap"},"zram swap"),(0,l.kt)("p",null,"Install and create a conf file with following."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo pacman -S zram-generator\nsudo nano /usr/lib/systemd/zram-generator.conf\n")),(0,l.kt)("p",null,"You may want to read up on zram. I always set 1.5 times the amount of system ram. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/systemd/zram-generator/blob/main/man/zram-generator.conf.md"},"github")," | ",(0,l.kt)("a",{parentName:"p",href:"https://haydenjames.io/raspberry-pi-performance-add-zram-kernel-parameters/"},"Hayden James")," |\n",(0,l.kt)("a",{parentName:"p",href:"https://lists.ubuntu.com/archives/lubuntu-users/2013-October/005831.html"},"lubuntu mailing list")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/usr/lib/systemd/zram-generator.conf"',title:'"/usr/lib/systemd/zram-generator.conf"'},"[zram0]\nzram-size = min(24 * 1024)\n")),(0,l.kt)("p",null,"This will give you 24gb of zram swap and will absorb the brunt of running the built in leaderlogs. Reboot and check htop to confirm."),(0,l.kt)("h2",{id:"prometheus"},"Prometheus"),(0,l.kt)("p",null,"Install Prometheus and Prometheus-node-exporter"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo pacman -S prometheus prometheus-node-exporter\n")),(0,l.kt)("h2",{id:"grafana"},"Grafana"),(0,l.kt)("p",null,"Two ways to install Grafana. From AUR or with snap. Pros and cons. Cannot install additional plugins with AUR version (looking into it). I need additional plugins so I built snap and installed Grafana with it."),(0,l.kt)("h3",{id:"with-snap"},"With Snap"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"mkdir ~/git\ncd ~/git\ngit clone https://aur.archlinux.org/snapd.git\ncd snapd/\nmakepkg -si\nreboot\nsudo snap install grafana --channel=rock/edge\n")),(0,l.kt)("h3",{id:"grafan-bin-aur"},"Grafan-bin AUR"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"mkdir ~/git\ncd ~/git\n\ngit clone https://aur.archlinux.org/grafana-bin.git\ncd grafana-bin\nmakepkg -si\nsudo systemctl start grafana.service\nsudo systemctl enable grafana.service\n\n")),(0,l.kt)("h2",{id:"wireguard"},"Wireguard"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo pacman -S wireguard-tools\n\n")),(0,l.kt)("h2",{id:"static-ip"},"Static ip"),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"You can also set a static IP on your router if you wish and skip this section."))),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Systemd-networkd#Wired_adapter_using_a_static_IP"},"systemd")),(0,l.kt)("p",null,"Create a network service file, make sure you edit it to your network."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo nano /etc/systemd/network/20-wired.network\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/etc/systemd/network/20-wired.network"',title:'"/etc/systemd/network/20-wired.network"'},"[Match]\nName=enp3s0\n\n[Network]\nAddress=192.168.1.151/24\nGateway=192.168.1.1\nDNS=192.168.1.1\n")),(0,l.kt)("p",null,"Make sure no other network service is running like netctl, then enable and start the service. If there is a network service running stop and disable it."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo systemctl --type=service\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo systemctl enable systemd-networkd.service\nsudo systemctl start systemd-networkd.service\n")),(0,l.kt)("p",null,"Disable/stop dhcp."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"\nsudo systemctl stop dhcpcd\nsudo systemctl disable dhcpcd\nsudo reboot\n")),(0,l.kt)("h2",{id:"hostname"},"Hostname"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Network_configuration#Set_the_hostname"},"Set the Hostname")),(0,l.kt)("p",null,"Edit /etc/hostname"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo nano /etc/hostname\n")),(0,l.kt)("p",null,"and /etc/hosts"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo nano /etc/hosts\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/etc/hosts"',title:'"/etc/hosts"'},"127.0.0.1        localhost\n::1              localhost\n127.0.1.1        myhostname\n")),(0,l.kt)("h2",{id:"server-setup"},"Server setup"),(0,l.kt)("p",null,"Tweak/Harden system to our needs."),(0,l.kt)("h2",{id:"sysctl"},"sysctl"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/sysctl"},"sysctl")),(0,l.kt)("p",null,"Create a file in the sysctl.d directory"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo nano /etc/sysctl.d/98-cardano-node.conf\n")),(0,l.kt)("p",null,"Add the following."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/etc/sysctl.d/98-cardano-node.conf"',title:'"/etc/sysctl.d/98-cardano-node.conf"'},"## Asahi Node ##\n\nfs.file-max = 10000000\nfs.nr_open = 10000000\n\n# ignore ICMP redirects\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.default.send_redirects = 0\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.default.accept_redirects = 0\n\nnet.ipv4.icmp_ignore_bogus_error_responses = 1\n\n# disable IPv6\n#net.ipv6.conf.all.disable_ipv6 = 1\n#net.ipv6.conf.default.disable_ipv6 = 1\n\n# block SYN attacks\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 2048\nnet.ipv4.tcp_synack_retries = 3\n#net.ipv4.netfilter.ip_conntrack_tcp_timeout_syn_recv=45\n\n# in progress tasks\nnet.ipv4.tcp_keepalive_time = 240\nnet.ipv4.tcp_keepalive_intvl = 4\nnet.ipv4.tcp_keepalive_probes = 5\n\n# reboot if we run out of memory\nvm.panic_on_oom = 1\nkernel.panic = 10\n")),(0,l.kt)("h3",{id:"disable-the-root-user"},"Disable the root user"),(0,l.kt)("p",null,"Use sudo to become root."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo passwd -l root\n")),(0,l.kt)("h3",{id:"secure-shared-memory"},"Secure shared memory"),(0,l.kt)("p",null,"Mount shared memory as read only. Open /etc/fstab."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo nano /etc/fstab\n")),(0,l.kt)("p",null,"Add this line at the bottom, save & exit."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/etc/fstab"',title:'"/etc/fstab"'},"tmpfs    /run/shm    tmpfs    ro,noexec,nosuid    0 0\n")),(0,l.kt)("h3",{id:"increase-open-file-limit-for-user"},"Increase open file limit for $USER"),(0,l.kt)("p",null,"Add a couple lines to the bottom of /etc/security/limits.conf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo bash -c \"echo -e '${USER} soft nofile 800000\\n${USER} hard nofile 1048576\\n' >> /etc/security/limits.conf\"\n")),(0,l.kt)("p",null,"Confirm it was added to the bottom."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cat /etc/security/limits.conf\n")),(0,l.kt)("h2",{id:"environment-setup"},"Environment setup"),(0,l.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"There is a 500 \u20b3 Registration deposit and another 5 \u20b3 in registration costs to start a pool on mainnet. First time users are strongly reccomended to use testnet. You can get tada (test ada) from the testnet faucet. ",(0,l.kt)("a",{parentName:"p",href:"https://testnets.cardano.org/en/testnets/cardano/tools/faucet/"},"tada faucet link")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"It is fairly easy to jump to mainnet when you are ready with the same machine. Only need to update files and folders to mainnet and redo pool creation."))),(0,l.kt)("p",null,"Create the directories for our project."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"mkdir -p ${HOME}/.local/bin\nmkdir -p ${HOME}/pi-pool/files\nmkdir -p ${HOME}/pi-pool/scripts\nmkdir -p ${HOME}/pi-pool/logs\nmkdir ${HOME}/git\nmkdir ${HOME}/tmp\n")),(0,l.kt)("p",null,"Create an .adaenv file, choose which network you want to be on and source the file. This file will hold the variables/settings for operating a Pi-Node. /home/ada/.adaenv"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"echo -e NODE_CONFIG=testnet >> ${HOME}/.adaenv; source ${HOME}/.adaenv\n")),(0,l.kt)("p",null,"Confirm you are on the desired network."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cat ${HOME}/.adaenv\n")),(0,l.kt)("h3",{id:"create-bash-variables--add-localbin-to-our-path-"},"Create bash variables & add ","~","/.local/bin to our $PATH \ud83c\udfc3"),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},(0,l.kt)("a",{parentName:"p",href:"https://askubuntu.com/questions/247738/why-is-etc-profile-not-invoked-for-non-login-shells/247769#247769"},"Environment Variables in Linux/Unix"),"."))),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"You must reload environment files after updating them. Same goes for cardano-node, changes to the topology or config files require a cardano-service restart."))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"echo . ~/.adaenv >> ${HOME}/.bashrc\ncd .local/bin; echo \"export PATH=\\\"$PWD:\\$PATH\\\"\" >> $HOME/.adaenv\necho export NODE_HOME=${HOME}/pi-pool >> ${HOME}/.adaenv\necho export NODE_PORT=3003 >> ${HOME}/.adaenv\necho export NODE_FILES=${HOME}/pi-pool/files >> ${HOME}/.adaenv\necho export TOPOLOGY='${NODE_FILES}'/'${NODE_CONFIG}'-topology.json >> ${HOME}/.adaenv\necho export DB_PATH='${NODE_HOME}'/db >> ${HOME}/.adaenv\necho export CONFIG='${NODE_FILES}'/'${NODE_CONFIG}'-config.json >> ${HOME}/.adaenv\necho export NODE_BUILD_NUM=$(curl https://hydra.iohk.io/job/Cardano/iohk-nix/cardano-deployment/latest-finished/download/1/index.html | grep -e \"build\" | sed 's/.*build\\/\\([0-9]*\\)\\/download.*/\\1/g') >> ${HOME}/.adaenv\necho export CARDANO_NODE_SOCKET_PATH=\"${HOME}/pi-pool/db/socket\" >> ${HOME}/.adaenv\nsource ${HOME}/.bashrc; source ${HOME}/.adaenv\n")),(0,l.kt)("h3",{id:"retrieve-node-files"},"Retrieve node files"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cd $NODE_FILES\nwget -N https://hydra.iohk.io/build/${NODE_BUILD_NUM}/download/1/${NODE_CONFIG}-config.json\nwget -N https://hydra.iohk.io/build/${NODE_BUILD_NUM}/download/1/${NODE_CONFIG}-byron-genesis.json\nwget -N https://hydra.iohk.io/build/${NODE_BUILD_NUM}/download/1/${NODE_CONFIG}-shelley-genesis.json\nwget -N https://hydra.iohk.io/build/${NODE_BUILD_NUM}/download/1/${NODE_CONFIG}-alonzo-genesis.json\nwget -N https://hydra.iohk.io/build/${NODE_BUILD_NUM}/download/1/${NODE_CONFIG}-topology.json\nwget -N https://raw.githubusercontent.com/input-output-hk/cardano-node/master/cardano-submit-api/config/tx-submit-mainnet-config.yaml\n")),(0,l.kt)("p",null,"Run the following to modify ${NODE","_",'CONFIG}-config.json and update TraceBlockFetchDecisions to "true" & listen on all interfaces with Prometheus Node Exporter.'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},'sed -i ${NODE_CONFIG}-config.json \\\n    -e "s/TraceBlockFetchDecisions\\": false/TraceBlockFetchDecisions\\": true/g" \\\n    -e "s/127.0.0.1/0.0.0.0/g"\n')),(0,l.kt)("p",null,"Save & exit."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"source ${HOME}/.adaenv\n")),(0,l.kt)("h2",{id:"build-libsodium"},"Build Libsodium"),(0,l.kt)("p",null,"This is IOHK's fork of Libsodium. It is needed for the dynamic build binary of cardano-node."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cd; cd git/\ngit clone https://github.com/input-output-hk/libsodium\ncd libsodium\ngit checkout 66f017f1\n./autogen.sh\n./configure\nmake\nsudo make install\n")),(0,l.kt)("p",null,"Add library path to ldconfig."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},'sudo touch /etc/ld.so.conf.d/local.conf \necho "/usr/local/lib" | sudo tee -a /etc/ld.so.conf.d/local.conf \n')),(0,l.kt)("p",null,"Echo library paths into .bashrc file and source it."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},'echo "export LD_LIBRARY_PATH="/usr/local/lib:$LD_LIBRARY_PATH"" >> ~/.bashrc\necho "export PKG_CONFIG_PATH="/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH"" >> ~/.bashrc\n. ~/.bashrc\n')),(0,l.kt)("p",null,"Update link cache for shared libraries and confirm."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo ldconfig; ldconfig -p | grep libsodium\n")),(0,l.kt)("h2",{id:"build-secp256k1"},"Build secp256k1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"git clone https://github.com/bitcoin-core/secp256k1.git\ncd secp256k1\ngit reset --hard $SECP256K1_REF\n./autogen.sh\n./configure  --enable-module-schnorrsig --enable-experimental\nmake\nsudo make install\n")),(0,l.kt)("p",null,"Update link cache for shared libraries and confirm."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo ldconfig; ldconfig -p | grep secp256k1\n")),(0,l.kt)("h2",{id:"llvm-901"},"LLVM 9.0.1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cd ~/git\nwget https://github.com/llvm/llvm-project/releases/download/llvmorg-9.0.1/clang+llvm-9.0.1-aarch64-linux-gnu.tar.xz\ntar -xf clang+llvm-9.0.1-aarch64-linux-gnu.tar.xz\nexport PATH=~/git/clang+llvm-9.0.1-aarch64-linux-gnu/bin/:$PATH\n")),(0,l.kt)("h2",{id:"ncurses5-compat-libs"},"ncurses5 compat libs"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cd ~/git\ngit clone https://aur.archlinux.org/ncurses5-compat-libs.git\ncd ncurses5-compat-libs/\ngpg --recv-key CC2AF4472167BE03\n## If this fails it is probly due to your DNS service(Google). \n## Use https://www.quad9.net/\n")),(0,l.kt)("p",null,"Change target architecture to aarch64 in the build file."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"nano PKGBUILD\narch=(aarch64)\n")),(0,l.kt)("p",null,"and build it."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"makepkg -si\n")),(0,l.kt)("p",null,"Confirm."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"clang --version\n")),(0,l.kt)("h2",{id:"ghcup-ghc--cabal"},"GHCUP, GHC & Cabal"),(0,l.kt)("p",null,"Install ghcup use defaults when asked."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"curl --proto '=https' --tlsv1.2 -sSf https://get-ghcup.haskell.org | sh\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},". ~/.bashrc\nghcup upgrade\nghcup install cabal 3.6.2.0\nghcup set cabal 3.6.2.0\n\nghcup install ghc 8.10.7\nghcup set ghc 8.10.7\n")),(0,l.kt)("h3",{id:"obtain-cardano-node"},"Obtain cardano-node"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cd $HOME/git\ngit clone https://github.com/input-output-hk/cardano-node.git\ncd cardano-node\ngit fetch --all --recurse-submodules --tags\ngit checkout $(curl -s https://api.github.com/repos/input-output-hk/cardano-node/releases/latest | jq -r .tag_name)\n")),(0,l.kt)("p",null,"Configure with 8.10.4 set libsodium"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},'cabal configure -O0 -w ghc-8.10.7\n\necho -e "package cardano-crypto-praos\\n flags: -external-libsodium-vrf" > cabal.project.local\nsed -i $HOME/.cabal/config -e "s/overwrite-policy:/overwrite-policy: always/g"\nrm -rf dist-newstyle/build/aarch64-linux/ghc-8.10.7\n')),(0,l.kt)("p",null,"Confirm."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cabal --version\nghc --version\n")),(0,l.kt)("p",null,"Build cardano-cli cardano-node cardano-submit-api."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cabal build cardano-cli cardano-node cardano-submit-api\n")),(0,l.kt)("p",null,"Add them to your PATH."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},'cp $(find $HOME/git/cardano-node/dist-newstyle/build -type f -name "cardano-cli") $HOME/.local/bin/\ncp $(find $HOME/git/cardano-node/dist-newstyle/build -type f -name "cardano-node") $HOME/.local/bin/\ncp $(find $HOME/git/cardano-node/dist-newstyle/build -type f -name "cardano-submit-api") $HOME/.local/bin/\n')),(0,l.kt)("p",null,"Check"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cardano-node version\ncardano-cli version\n")),(0,l.kt)("h3",{id:"systemd-unit-startup-scripts"},"Systemd unit startup scripts"),(0,l.kt)("p",null,"Create the systemd unit file and startup script so systemd can manage cardano-node."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"nano ${HOME}/.local/bin/cardano-service\n")),(0,l.kt)("p",null,"Paste the following, save & exit."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="${HOME}/.local/bin/cardano-service"',title:'"${HOME}/.local/bin/cardano-service"'},"#!/bin/bash\n. /home/ada/.adaenv\n\n## +RTS -N6 -RTS = Multicore(4)\ncardano-node run +RTS -N6 -RTS \\\n  --topology ${TOPOLOGY} \\\n  --database-path ${DB_PATH} \\\n  --socket-path ${CARDANO_NODE_SOCKET_PATH} \\\n  --port ${NODE_PORT} \\\n  --config ${CONFIG}\n")),(0,l.kt)("p",null,"Allow execution of our new cardano-node service file."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"chmod +x ${HOME}/.local/bin/cardano-service\n")),(0,l.kt)("p",null,"Open /etc/systemd/system/cardano-node.service."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo nano /etc/systemd/system/cardano-node.service\n")),(0,l.kt)("p",null,"Paste the following, You will need to edit the username here if you chose to not use ada. Save & exit."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/etc/systemd/system/cardano-node.service"',title:'"/etc/systemd/system/cardano-node.service"'},'# The Cardano Node Service (part of systemd)\n# file: /etc/systemd/system/cardano-node.service\n\n[Unit]\nDescription     = Cardano node service\nWants           = network-online.target\nAfter           = network-online.target\n\n[Service]\nUser            = ada\nType            = simple\nWorkingDirectory= /home/ada/pi-pool\nExecStart       = /bin/bash -c "PATH=/home/ada/.local/bin:$PATH exec /home/ada/.local/bin/cardano-service"\nKillSignal=SIGINT\nRestartKillSignal=SIGINT\nTimeoutStopSec=10\nLimitNOFILE=32768\nRestart=always\nRestartSec=10\nEnvironmentFile=-/home/ada/.adaenv\n\n[Install]\nWantedBy= multi-user.target\n')),(0,l.kt)("p",null,"Create the systemd unit file and startup script so systemd can manage cardano-submit-api."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"nano ${HOME}/.local/bin/cardano-submit-service\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="${HOME}/.local/bin/cardano-submit-service"',title:'"${HOME}/.local/bin/cardano-submit-service"'},"#!/bin/bash\n. /home/ada/.adaenv\n\ncardano-submit-api \\\n  --socket-path ${CARDANO_NODE_SOCKET_PATH} \\\n  --port 8090 \\\n  --config /home/ada/pi-pool/files/tx-submit-mainnet-config.yaml \\\n  --listen-address 0.0.0.0 \\\n  --mainnet\n")),(0,l.kt)("p",null,"Allow execution of our new cardano-submit-api service script."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"chmod +x ${HOME}/.local/bin/cardano-submit-service\n")),(0,l.kt)("p",null,"Create /etc/systemd/system/cardano-submit.service."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo nano /etc/systemd/system/cardano-submit.service\n")),(0,l.kt)("p",null,"Paste the following, You will need to edit the username here if you chose to not use ada. save & exit."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/etc/systemd/system/cardano-submit.service"',title:'"/etc/systemd/system/cardano-submit.service"'},'# The Cardano Submit Service (part of systemd)\n# file: /etc/systemd/system/cardano-submit.service\n\n[Unit]\nDescription     = Cardano submit service\nWants           = network-online.target\nAfter           = network-online.target\n\n[Service]\nUser            = ada\nType            = simple\nWorkingDirectory= /home/ada/pi-pool\nExecStart       = /bin/bash -c "PATH=/home/ada/.local/bin:$PATH exec /home/ada/.local/bin/cardano-submit-service"\nKillSignal=SIGINT\nRestartKillSignal=SIGINT\nTimeoutStopSec=10\nLimitNOFILE=32768\nRestart=always\nRestartSec=10\nEnvironmentFile=-/home/ada/.adaenv\n\n[Install]\nWantedBy= multi-user.target\n')),(0,l.kt)("p",null,"Reload systemd so it picks up our new service files."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo systemctl daemon-reload\n")),(0,l.kt)("p",null,"Let's add a couple functions to the bottom of our .adaenv file to make life a little easier."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"nano ${HOME}/.adaenv\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="${HOME}/.adaenv"',title:'"${HOME}/.adaenv"'},'cardano-service() {\n    #do things with parameters like $1 such as\n    sudo systemctl "$1" cardano-node.service\n}\n\ncardano-submit() {\n    #do things with parameters like $1 such as\n    sudo systemctl "$1" cardano-submit.service\n}\n\ncardano-monitor() {\n    #do things with parameters like $1 such as\n    sudo systemctl "$1" prometheus.service\n    sudo systemctl "$1" prometheus-node-exporter.service\n    sudo systemctl "$1" grafana-server\n}\n')),(0,l.kt)("p",null,"What we just did there was add a couple functions to control our cardano-service and cardano-submit without having to type out"),(0,l.kt)("blockquote",null,(0,l.kt)("blockquote",{parentName:"blockquote"},(0,l.kt)("p",{parentName:"blockquote"},"sudo systemctl enable cardano-node.service"),(0,l.kt)("p",{parentName:"blockquote"},"sudo systemctl start cardano-node.service"),(0,l.kt)("p",{parentName:"blockquote"},"sudo systemctl stop cardano-node.service"),(0,l.kt)("p",{parentName:"blockquote"},"sudo systemctl status cardano-node.service"))),(0,l.kt)("p",null,"Now we just have to:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"cardano-service enable (enables cardano-node.service auto start at boot)"),(0,l.kt)("li",{parentName:"ul"},"cardano-service start (starts cardano-node.service)"),(0,l.kt)("li",{parentName:"ul"},"cardano-service stop (stops cardano-node.service)"),(0,l.kt)("li",{parentName:"ul"},"cardano-service status (shows the status of cardano-node.service)")),(0,l.kt)("p",null,"Or"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"cardano-submit enable (enables cardano-submit.service auto start at boot)"),(0,l.kt)("li",{parentName:"ul"},"cardano-submit start (starts cardano-submit.service)"),(0,l.kt)("li",{parentName:"ul"},"cardano-submit stop (stops cardano-submit.service)"),(0,l.kt)("li",{parentName:"ul"},"cardano-submit status (shows the status of cardano-submit.service)")),(0,l.kt)("p",null,"The submit service listens on port 8090. You can connect your dapp wallet like below to submit tx's yourself in the wallets settings."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="wallet submit url"',title:'"wallet',submit:!0,'url"':!0},"http://<node lan ip>:8090/api/submit/tx\n")),(0,l.kt)("h2",{id:"gliveviewsh"},"gLiveView.sh"),(0,l.kt)("p",null,"Guild operators scripts has a couple useful tools for operating a pool. We do not want the project as a whole, though there are a couple scripts we are going to use."),(0,l.kt)("p",null,'{% embed url="',(0,l.kt)("a",{parentName:"p",href:"https://github.com/cardano-community/guild-operators/tree/master/scripts/cnode-helper-scripts%22"},'https://github.com/cardano-community/guild-operators/tree/master/scripts/cnode-helper-scripts"')," %}"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"cd $NODE_HOME/scripts\nwget https://raw.githubusercontent.com/cardano-community/guild-operators/master/scripts/cnode-helper-scripts/env\nwget https://raw.githubusercontent.com/cardano-community/guild-operators/master/scripts/cnode-helper-scripts/gLiveView.sh\n")),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"You can change the port cardano-node runs on in the .adaenv file in your home directory. Open the file edit the port number. Load the change into your shell & restart the cardano-node service."),(0,l.kt)("pre",{parentName:"div"},(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"nano /home/ada/.adaenv\nsource /home/ada/.adaenv\ncardano-service restart\n")))),(0,l.kt)("p",null,"Add a line sourcing our .adaenv file to the top of the env file and adjust some paths."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},'sed -i env \\\n    -e "/#CNODEBIN/i. ${HOME}/.adaenv" \\\n    -e "s/\\#CNODE_HOME=\\"\\/opt\\/cardano\\/cnode\\"/CNODE_HOME=\\"\\${HOME}\\/pi-pool\\"/g" \\\n    -e "s/\\#CNODE_PORT=6000"/CNODE_PORT=\\"\'${NODE_PORT}\'\\""/g" \\\n    -e "s/\\#CONFIG=\\"\\${CNODE_HOME}\\/files\\/config.json\\"/CONFIG=\\"\\${NODE_FILES}\\/"\'${NODE_CONFIG}\'"-config.json\\"/g" \\\n    -e "s/\\#TOPOLOGY=\\"\\${CNODE_HOME}\\/files\\/topology.json\\"/TOPOLOGY=\\"\\${NODE_FILES}\\/"\'${NODE_CONFIG}\'"-topology.json\\"/g" \\\n    -e "s/\\#LOG_DIR=\\"\\${CNODE_HOME}\\/logs\\"/LOG_DIR=\\"\\${CNODE_HOME}\\/logs\\"/g"\n')),(0,l.kt)("p",null,"Allow execution of gLiveView.sh."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"chmod +x gLiveView.sh\n")),(0,l.kt)("h2",{id:"install-cronie"},"Install Cronie"),(0,l.kt)("p",null,"Arch does not use cron. You can set up a systemd timer or install some other cron like scheduler."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo pacman -S cronie\n")),(0,l.kt)("p",null,"Enable & start."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo systemctl enable cronie.service\nsudo systemctl start cronie.service\n")),(0,l.kt)("h2",{id:"topologyupdatersh-not-needed-on-block-producer"},"topologyUpdater.sh (not needed on block producer)"),(0,l.kt)("p",null,"Until peer to peer is enabled on the network operators need a way to get a list of relays/peers to connect to. The topology updater service runs in the background with cron. Every hour the script will run and tell the service you are a relay and want to be a part of the network. It will add your relay to it's directory after four hours you should see in connections in gLiveView."),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"The list generated will show you the distance & a clue as to where the relay is located."))),(0,l.kt)("p",null,"Download the topologyUpdater script and have a look at it. Here is where you will enter your block producer or any other custom peers you would like to always be connected to."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"wget https://raw.githubusercontent.com/cardano-community/guild-operators/master/scripts/cnode-helper-scripts/topologyUpdater.sh\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"nano topologyUpdater.sh\n")),(0,l.kt)("p",null,"Save, exit and make it executable."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"chmod +x topologyUpdater.sh\n")),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"You will not be able to successfully execute ./topologyUpdater.sh until you are fully synced up to the tip of the chain."))),(0,l.kt)("p",null,"Create a cron job that will run once an hour."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"EDITOR=nano crontab -e\n")),(0,l.kt)("h3",{id:"add-save-and-exit"},"Add save and exit"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"SHELL=/bin/bash\n33 * * * * . $HOME/.adaenv; $HOME/pi-pool/scripts/topologyUpdater.sh\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"nano $NODE_FILES/${NODE_CONFIG}-topology.json\n")),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"You can use gLiveView.sh to view ping times in relation to the peers in your {NODE","_","CONFIG}-topology file. Use Ping to resolve hostnames to IP's."))),(0,l.kt)("p",null,"Changes to this file will take affect upon restarting the cardano-service."),(0,l.kt)("h2",{id:"display-inbound-connections-in-grafana"},"Display inbound connections in Grafana"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"mkdir -p $HOME/custom-metrics/tmp\nnano $HOME/custom-metrics/peers_in.sh\n")),(0,l.kt)("p",null,"Add following, update port # to match cardano-node port."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},'INCOMING_PEERS="$(ss -tnp state established | grep "cardano-node" | awk -v port=":3003" \'$3 ~ port {print}\' | wc -l)"\necho "peers_in ${INCOMING_PEERS}" > /home/ada/custom-metrics/tmp/peers_in.prom.tmp\nmv /home/ada/custom-metrics/tmp/peers_in.prom.tmp /var/lib/node_exporter/peers_in.prom\n')),(0,l.kt)("p",null,"Make it executable."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"chmod +x $HOME/custom-metrics/peers_in.sh\n")),(0,l.kt)("p",null,"Open node-exporter configuration file and add.."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo nano /etc/conf.d/prometheus-node-exporter\n")),(0,l.kt)("p",null,"Make it look like this."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"NODE_EXPORTER_ARGS='--collector.textfile.directory=/var/lib/node_exporter'\n")),(0,l.kt)("p",null,"Create that directory."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo mkdir /var/lib/node_exporter\n")),(0,l.kt)("p",null,"Create a cron job as root to run our script every minute."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo EDITOR=nano crontab -e\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"SHELL=/bin/bash\n* * * * * /home/ada/custom-metrics/peers_in.sh\n")),(0,l.kt)("p",null,"Restart prometheus-node-xporter."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo systemctl restart prometheus-node-exporter\n")),(0,l.kt)("p",null,"After a minute you should be able to find a metric in Grafana called 'peers_in'."),(0,l.kt)("h2",{id:"system-updates"},"System updates"),(0,l.kt)("p",null,"Track available system upgrades(pacman)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"nano $HOME/custom-metrics/pacman_upgrades.sh\n")),(0,l.kt)("p",null,"Add following."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},'UPDATES="$(/usr/bin/checkupdates | wc -l)"\necho "pacman_upgrades_pending ${UPDATES}" > /home/ada/custom-metrics/tmp/pacman_upgrades_pending.prom.tmp\nmv /home/ada/custom-metrics/tmp/pacman_upgrades_pending.prom.tmp /var/lib/node_exporter/pacman_upgrades_pending.prom\n')),(0,l.kt)("p",null,"Make it executable."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"chmod +x $HOME/custom-metrics/pacman_upgrades.sh\n")),(0,l.kt)("p",null,"Create a cron job as root to run our script once a day at 1 am."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo EDITOR=nano crontab -e\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"0 1 * * * /home/ada/custom-metrics/pacman_upgrades.sh\n")),(0,l.kt)("p",null,"Restart prometheus-node-xporter."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=">_ Terminal"',title:'">_','Terminal"':!0},"sudo systemctl restart prometheus-node-exporter\n")),(0,l.kt)("p",null,"In Grafana find the 'pacman_upgrades_pending' metric. It will not be available until you fire off the script or cron runs it."),(0,l.kt)("h2",{id:"usefull-links"},"Usefull links"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://nsrc.org/workshops/2021/sanog37/nmm/netmgmt/en/prometheus/ex-custom-metrics.htm"},"custom-metrics")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://vdwaa.nl/arch-prometheus-monitoring.html"},"arch prometheus monitoring")))}u.isMDXComponent=!0}}]);