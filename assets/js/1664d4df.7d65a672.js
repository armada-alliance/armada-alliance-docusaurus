"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[6910],{7241:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var t=s(4848),i=s(8453);const o={},a="Pi-Cold",r={id:"stake-pool-guides/pi-pool-tutorial/pi-node-full-guide/cold-offline",title:"Pi-Cold",description:"Cold server setup",source:"@site/docs/stake-pool-guides/pi-pool-tutorial/pi-node-full-guide/cold-offline.md",sourceDirName:"stake-pool-guides/pi-pool-tutorial/pi-node-full-guide",slug:"/stake-pool-guides/pi-pool-tutorial/pi-node-full-guide/cold-offline",permalink:"/docs/stake-pool-guides/pi-pool-tutorial/pi-node-full-guide/cold-offline",draft:!1,unlisted:!1,editUrl:"https://github.com/armada-alliance/docs/edit/master/docs/stake-pool-guides/pi-pool-tutorial/pi-node-full-guide/cold-offline.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Pi-Core",permalink:"/docs/stake-pool-guides/pi-pool-tutorial/pi-node-full-guide/core-online"},next:{title:"Introduction",permalink:"/docs/stake-pool-guides/pi-pool-tutorial/pi-node-full-guide/stakepoolscripts"}},l={},d=[{value:"Cold server setup",id:"cold-server-setup",level:2},{value:"Ubuntu or Raspbian",id:"ubuntu-or-raspbian",level:4},{value:"Log in &amp; setup user",id:"log-in--setup-user",level:3},{value:"USB transfer",id:"usb-transfer",level:3},{value:"Test your drive mounts",id:"test-your-drive-mounts",level:4},{value:"Transfer contents of the USB stick.",id:"transfer-contents-of-the-usb-stick",level:3},{value:"Install VSCodium",id:"install-vscodium",level:3},{value:"Pool Creation",id:"pool-creation",level:3}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"pi-cold",children:"Pi-Cold"}),"\n",(0,t.jsx)(n.h2,{id:"cold-server-setup",children:"Cold server setup"}),"\n",(0,t.jsx)(n.p,{children:"This can be any 64 bit capable Raspi. Any Raspberry Pi 4, Raspberry Pi 3b+ or a Raspberry Pi-400. I would use a Pi-400. Keyboard is built in which is convenient and safer. The cold machine is only used to sign transactions and is left powered down for 99% of the time(if not more). The Pi-400 can just be powered off and in a safe. Also unlike an online node, the Cold machine can be run from the sdcard. Just make sure you have multiple copies of your keys just in case you get a bad sdcard. Or better yet clone this system onto 3 or 4 other bootable sdcards. Remember you can also boot from USB."}),"\n",(0,t.jsx)(n.h4,{id:"ubuntu-or-raspbian",children:"Ubuntu or Raspbian"}),"\n",(0,t.jsx)(n.p,{children:"Raspberry Pi OS desktop is a lot faster and more stable than the gnome desktop in Ubuntu. There is now a 64bit image you can install, it is not available in raspi-imager selection, IDK why. Check out the images in the link below grab the latest version. It is a zip file so we have to unzip it."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://downloads.raspberrypi.org/raspios_arm64",children:"Download Pi 64bit Raspbian OS"})}),"\n",(0,t.jsx)(n.p,{children:"Unzip the img file and flash it with Raspi-imager."}),"\n",(0,t.jsx)(n.h3,{id:"log-in--setup-user",children:"Log in & setup user"}),"\n",(0,t.jsx)(n.p,{children:"Disable the radios. It would just be foolish to leave these enabled.."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo rfkill block wifi\nsudo rfkill block bluetooth\n"})}),"\n",(0,t.jsx)(n.p,{children:"I put a network jack without a wire into the NIC port to block it. Preventing any accidental insertion."}),"\n",(0,t.jsx)(n.p,{children:"Open up Preferences/Raspberry Pi Configuration window(GUI) and disable auto login."}),"\n",(0,t.jsx)(n.p,{children:"Create the $USER and add it to sudoers. ada in our case. We have to create a new user so the uid, gid and name match that of the core. It is far less error prone than trying to change the user id of the default user. With the user/group id of 1001 you will not run into issues with permissions transferring between systems."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo adduser ada; sudo adduser ada sudo\n"})}),"\n",(0,t.jsx)(n.p,{children:"Reboot the server to stop the autologin pi user process running in the background. Log in as ada and delete the pi user."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo deluser --remove-home pi\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"If you find your keyboard is not correctly printing the home symbol ~, you repair with, sudo locale-gen and reboot."})}),"\n",(0,t.jsx)(n.h3,{id:"usb-transfer",children:"USB transfer"}),"\n",(0,t.jsx)(n.p,{children:"Basically repeating the steps to setup an fstab entry from the Core guide. This is to mount the USB transfer disk at boot should you have it inserted when you power on. It also makes the mount command simpler. You can just sudo mount usb-transfer."}),"\n",(0,t.jsx)(n.p,{children:"Create the mount point & set default ACL for files and folders with umask."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd; mkdir $HOME/usb-transfer; umask 022 $HOME/usb-transfer\n"})}),"\n",(0,t.jsx)(n.p,{children:"Attach the external drive and list all drives with fdisk."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo fdisk -l\n"})}),"\n",(0,t.jsx)(n.p,{children:"If you are booting from the sdcard the first inserted disk is /dev/sda. The sdcard you are booting from will have the /dev/mmcblk0 designation."}),"\n",(0,t.jsx)(n.p,{children:"Example output for my system:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"Disk /dev/sda: 57.66 GiB, 61907927040 bytes, 120913920 sectors\nDisk model: Cruzer\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: 75B71A3E-9E1A-4659-94D0-E0C949A26740\n\nDevice     Start       End   Sectors  Size Type\n/dev/sda1   2048 120913886 120911839 57.7G Linux filesystem\n"})}),"\n",(0,t.jsx)(n.p,{children:"In my case it is /dev/sda because I am using the sdcard slot in the pi-400. Yours may be /dev/sdb, /dev/sdc, /dev/sdd or so on. /dev/sda is usually the system drive. Just be careful you are dealing with the correct drive."}),"\n",(0,t.jsx)(n.p,{children:"Locate your drive and get the UUID for the partition we created earlier."}),"\n",(0,t.jsx)(n.p,{children:"Run blkid and copy the UUID. In my case it is the UUID for /dev/sda1."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo blkid\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'UUID="c2a8f8c7-3e7a-40f2-8dac-c2b16ab07f37"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Add a mount entry to the bottom of fstab adding your UUID and the full system path to you backup folder."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo nano /etc/fstab\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"UUID=c2a8f8c7-3e7a-40f2-8dac-c2b16ab07f37 /home/ada/usb-transfer auto nosuid,nodev,nofail 0 1\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"nofail allows the server to boot if the drive is not inserted."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"test-your-drive-mounts",children:"Test your drive mounts"}),"\n",(0,t.jsx)(n.p,{children:"Mount the drive and confirm it mounted by locating listing the contents. You should see the ada folder, offline-transfer and lost&found. If they are not present then your drive is not mounted."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo mount usb-transfer; ls $HOME/usb-transfer\n"})}),"\n",(0,t.jsx)(n.h3,{id:"transfer-contents-of-the-usb-stick",children:"Transfer contents of the USB stick."}),"\n",(0,t.jsx)(n.p,{children:"The cold machine will never be online, these machines do not have any cmos battery to keep time. It should not pose too many issues if any. Just be aware that when you fire up the cold machine it's time is off."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd; rsync -aP usb-transfer/ada/ ~/\n"})}),"\n",(0,t.jsx)(n.p,{children:"Source the .adaenv file on login."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"echo . ~/.adaenv >> ~/.bashrc\n"})}),"\n",(0,t.jsx)(n.p,{children:"Switch the Stake Pool Operator scripts to 'offline mode'."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'cd\nsed -i stakepoolscripts/bin/common.inc \\\n    -e \'s#offlineMode="no"#offlineMode="yes"#\'\n'})}),"\n",(0,t.jsx)(n.p,{children:"Move the jq binary into it's system PATH."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo cp usb-transfer/ada/jq /usr/local/bin\njq -V\n"})}),"\n",(0,t.jsx)(n.p,{children:"Confirm SPOS is installed."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:". .adaenv; 00_common.sh\n"})}),"\n",(0,t.jsx)(n.h3,{id:"install-vscodium",children:"Install VSCodium"}),"\n",(0,t.jsx)(n.p,{children:"Right click on the VSCodium .deb file in the usb-transfer folder and choose install. You can then open the markdown files and use ctr+shift+V to render a preview."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://vscodium.com",children:"VSCodium Website"})}),"\n",(0,t.jsx)(n.h3,{id:"pool-creation",children:"Pool Creation"}),"\n",(0,t.jsx)(n.p,{children:"That's it! you can now use Martins guide in the stakepoolscripts/bin file. Remember to always manually unmount your USB stick before unplugging it."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/gitmachtl/scripts",children:"Stake pool operator scripts GitHub"})}),"\n",(0,t.jsx)(n.p,{children:"Thank you Martin for all your hard work!"})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>r});var t=s(6540);const i={},o=t.createContext(i);function a(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);