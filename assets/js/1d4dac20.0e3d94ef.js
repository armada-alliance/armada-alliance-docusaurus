"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[7030],{3319:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});var i=s(4848),a=s(8453);const t={},o="Setup guide for Ogmios proxied through Nginx with basic auth without TLS",r={id:"stake-pool-guides/ogmios",title:"Setup guide for Ogmios proxied through Nginx with basic auth without TLS",description:"This guide is not going to cover Nginx with TLS. Be aware that sending the basic auth username and password to Nginx will be clear text over the wire. For TLS with certbot and Nginx you will need a DNS name. This is a simple protection to prevent abuse. Use a simple password and know it can be read by 5 eyes.",source:"@site/docs/stake-pool-guides/ogmios.md",sourceDirName:"stake-pool-guides",slug:"/stake-pool-guides/ogmios",permalink:"/docs/stake-pool-guides/ogmios",draft:!1,unlisted:!1,editUrl:"https://github.com/armada-alliance/docs/edit/master/docs/stake-pool-guides/ogmios.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Cardano Submit Transaction API Tutorial",permalink:"/docs/cardano-developer-guides/cardano-submit-tx-api-tutorial"},next:{title:"Create .img file",permalink:"/docs/cardano-developer-guides/create-.img-file"}},l={},c=[{value:"Make sure ~/.local/bin exists and grab the binary.",id:"make-sure-localbin-exists-and-grab-the-binary",level:3},{value:"Confirm Ogmios is in PATH",id:"confirm-ogmios-is-in-path",level:2},{value:"Create startup script &amp; systemd unit file",id:"create-startup-script--systemd-unit-file",level:3},{value:"Create the systemd unit file.",id:"create-the-systemd-unit-file",level:2},{value:"Install Nginx &amp; apache-utils",id:"install-nginx--apache-utils",level:2},{value:"Create Basic Authentication File",id:"create-basic-authentication-file",level:3},{value:"Create Nginx server block",id:"create-nginx-server-block",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"setup-guide-for-ogmios-proxied-through-nginx-with-basic-auth-without-tls",children:"Setup guide for Ogmios proxied through Nginx with basic auth without TLS"}),"\n",(0,i.jsx)(n.admonition,{title:"Basic auth without TLS",type:"caution",children:(0,i.jsx)(n.p,{children:"This guide is not going to cover Nginx with TLS. Be aware that sending the basic auth username and password to Nginx will be clear text over the wire. For TLS with certbot and Nginx you will need a DNS name. This is a simple protection to prevent abuse. Use a simple password and know it can be read by 5 eyes."})}),"\n",(0,i.jsx)(n.p,{children:"This guide assumes you have a cardano-node synced & running on the same server."}),"\n",(0,i.jsx)(n.p,{children:"Grab the latest Ogmios binary here for your systems architecture."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://github.com/CardanoSolutions/ogmios/releases",children:"Ogmios latest release"})}),"\n",(0,i.jsx)(n.p,{children:"Put it somewhere in system PATH. I use ~/.local/bin but you can put the binary in the same folder you keep cardano-node binary. This is what I'll use in this guide. Update accordingly."}),"\n",(0,i.jsx)(n.h3,{id:"make-sure-localbin-exists-and-grab-the-binary",children:"Make sure ~/.local/bin exists and grab the binary."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir ~/.local/bin\nmkdir ~/tmp\ncd ~/tmp\n\n# Replace URL with current release/architecture link.\nwget https://github.com/CardanoSolutions/ogmios/releases/download/v6.3.0/ogmios-v6.3.0-aarch64-linux.zip\nunzip ogmios-*\nmv ~/tmp/ogmios/bin/ogmios ~/.local/bin\nchmod +x ~/.local/bin/ogmios\n"})}),"\n",(0,i.jsx)(n.p,{children:"Add ~/.local/bin to the users PATH"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'cd ~/.local/bin; echo "export PATH=\\"$PWD:\\$PATH\\"" >> $HOME/.bashrc\nsource ~/.bashrc\n'})}),"\n",(0,i.jsx)(n.h2,{id:"confirm-ogmios-is-in-path",children:"Confirm Ogmios is in PATH"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ogmios version\n"})}),"\n",(0,i.jsx)(n.h3,{id:"create-startup-script--systemd-unit-file",children:"Create startup script & systemd unit file"}),"\n",(0,i.jsx)(n.p,{children:"Create a startup script for Ogmios edit below to correct socket and config.json locations."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nano ${HOME}/.local/bin/ogmios-service\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\nogmios --host 127.0.0.1 --node-socket <path to cardano node socket> --node-config <path to cardano node config.json>\n"})}),"\n",(0,i.jsx)(n.p,{children:"Make it executable."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"chmod +x ${HOME}/.local/bin/ogmios-service\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Test it. ctrl+c to exit."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"${HOME}/.local/bin/ogmios-service\n\n"})}),"\n",(0,i.jsx)(n.h2,{id:"create-the-systemd-unit-file",children:"Create the systemd unit file."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sudo tee /etc/systemd/system/ogmios.service <<EOF\n# Ogmios Service\n[Unit]\nDescription=Ogmios Service\nAfter=network.target\n\n[Service]\nUser=${USER}\nExecStart=/bin/bash -c "PATH=${HOME}/.local/bin:\\$PATH exec ${HOME}/.local/bin/ogmios-service"\nRestart=always\nRestartSec=10\nLimitNOFILE=4096\n\n[Install]\nWantedBy=multi-user.target\nEOF\n'})}),"\n",(0,i.jsx)(n.p,{children:"Start the service, confirm its running."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\nsudo systemctl start ogmios.service\njournalctl -u ogmios.service -f\n"})}),"\n",(0,i.jsx)(n.p,{children:"If everything looks good enable start at boot."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable ogmios.service\n"})}),"\n",(0,i.jsx)(n.h2,{id:"install-nginx--apache-utils",children:"Install Nginx & apache-utils"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt install nginx\nsudo apt install apache2-utils\n"})}),"\n",(0,i.jsx)(n.h3,{id:"create-basic-authentication-file",children:"Create Basic Authentication File"}),"\n",(0,i.jsx)(n.p,{children:"Create a basic authentication file to secure access to the Ogmios server. Be sure to edit the username. You will be prompted to add a password\nwhich will be hashed on disk."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo htpasswd -c /etc/nginx/.ogmios <username>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"create-nginx-server-block",children:"Create Nginx server block"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sudo tee /etc/nginx/sites-available/ogmios > /dev/null <<EOF\nserver {\n    listen 80 default_server;  # Listen on port 80 and make this the default server\n\n    access_log /var/log/nginx/ogmios.access.log;\n    error_log /var/log/nginx/ogmios.online.error.log;\n\n    add_header X-Proxy-Cache \\$upstream_cache_status;\n\n    location / {\n        auth_basic "You Shall Not Pass";\n        auth_basic_user_file /etc/nginx/.ogmios;\n        proxy_pass http://127.0.0.1:1337;\n        proxy_redirect off;\n        include proxy_params;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade \\$http_upgrade;\n        proxy_set_header Connection "upgrade";\n    }\n}\nEOF\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"Link it to sites enabled."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo ln -s /etc/nginx/sites-available/ogmios /etc/nginx/sites-enabled/\n"})}),"\n",(0,i.jsx)(n.p,{children:"Unlink the current default server block"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo unlink /etc/nginx/sites-enabled/default\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ensure Nginx is happy with it."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nginx -t\n"})}),"\n",(0,i.jsx)(n.p,{children:"If everything is ok.."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo service nginx restart\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ensure port 80 is open in your firewall. You should then be able to enter the servers public IP in your browser."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>r});var i=s(6540);const a={},t=i.createContext(a);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);