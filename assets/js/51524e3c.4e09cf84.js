"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[4451],{5021:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var s=t(4848),i=t(8453);const r={},o="Part 3: Run the Node in the Background as a tmux Session",a={id:"ergo-developer-guides/part3-run-node-in-background-tmux",title:"Part 3: Run the Node in the Background as a tmux Session",description:"I eventually encountered the problem everytime my computer went to sleep, say on the macbook laptop, the terminal ssh session would break and the node would not run and sync in the background.",source:"@site/docs/ergo-developer-guides/part3-run-node-in-background-tmux.md",sourceDirName:"ergo-developer-guides",slug:"/ergo-developer-guides/part3-run-node-in-background-tmux",permalink:"/docs/ergo-developer-guides/part3-run-node-in-background-tmux",draft:!1,unlisted:!1,editUrl:"https://github.com/armada-alliance/docs/edit/master/docs/ergo-developer-guides/part3-run-node-in-background-tmux.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Part 2: Ergo Full Node Setup",permalink:"/docs/ergo-developer-guides/part2-ergo-full-node"},next:{title:"Part 4: Robust Run Node in Pi Background Systemd (in-work)",permalink:"/docs/ergo-developer-guides/part4-robust-run-node-in-background-systemd"}},l={},d=[{value:"So what is Tmux?",id:"so-what-is-tmux",level:2},{value:"Installation",id:"installation",level:2},{value:"Get into the rpi with tmux session",id:"get-into-the-rpi-with-tmux-session",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"part-3-run-the-node-in-the-background-as-a-tmux-session",children:"Part 3: Run the Node in the Background as a tmux Session"}),"\n",(0,s.jsx)(n.p,{children:"I eventually encountered the problem everytime my computer went to sleep, say on the macbook laptop, the terminal ssh session would break and the node would not run and sync in the background."}),"\n",(0,s.jsxs)(n.p,{children:["I was given advice that an easy fix was to ",(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:'"tmux it"'})})," for running in the background by ",(0,s.jsx)(n.a,{href:"https://twitter.com/Piada_stakePool",children:"@Wael of PIADA Stake Pool founder of Armada Alliance"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"This was brand new to me and required a bit of an overwhelming learning curve that now seems simple and really is great to know."}),"\n",(0,s.jsx)(n.p,{children:"In reality, you only need to know about 5 things."}),"\n",(0,s.jsx)(n.h2,{id:"so-what-is-tmux",children:"So what is Tmux?"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/tmux/tmux",children:"Tmux on Github"})," describes their projects as:"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"tmux is a terminal multiplexer: it enables a number of terminals to be created, accessed, and controlled from a single screen. tmux may be detached from a screen and continue running in the background, then later reattached."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Here's a video my super hacker brother shared with me:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.youtube.com/watch?v=DzNmUNvnB04",children:(0,s.jsx)(n.img,{alt:"Tmux has forever changed the way I write code.",src:t(4806).A+"",width:"2280",height:"1402"})})}),"\n",(0,s.jsx)(n.p,{children:"In reality, you only need to know the basics, about 5 things, and level up from there."}),"\n",(0,s.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsxs)(n.p,{children:["From your ",(0,s.jsx)(n.strong,{children:"local machine"}),", that is, not the rpi, install tmux."]}),"\n",(0,s.jsx)(n.p,{children:"For rpi linux, we can download tmux using pacman that package manager"}),"\n",(0,s.jsx)(n.p,{children:"Note, we'll need to download dependancies"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo pacman -S tmux\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or find your package manager for your OS here:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/tmux/tmux/wiki/Installing",children:"https://github.com/tmux/tmux/wiki/Installing"})}),"\n",(0,s.jsxs)(n.p,{children:["E.g. for macOS ",(0,s.jsx)(n.code,{children:"brew install tmux"})]}),"\n",(0,s.jsx)(n.p,{children:"Else: you'll need to download dependancies from the tmux manually from the readme:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"libevent"}),"\n",(0,s.jsx)(n.li,{children:"ncurses"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Test:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/tmux/tmux.git\ncd tmux\nsh autogen.sh\n./configure && make\n"})}),"\n",(0,s.jsx)(n.p,{children:"WARNING: If you run the above and the last line has"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:'configure: error: "libevent not found"'}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"You need to download the dependencies."}),"\n",(0,s.jsx)(n.p,{children:"From here, we'll need some pluggins to make it run smooth and nicely:"}),"\n",(0,s.jsxs)(n.p,{children:["Basically, follow the steps from ",(0,s.jsx)(n.a,{href:"https://github.com/tmux-plugins/tpm",children:"Github tmux-plugins"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm\n"})}),"\n",(0,s.jsx)(n.p,{children:"Next, create the configuration file"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd\ntouch .tmux.conf\nnano .tmux.conf\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Note: this is tricky. Some versions have making this file in ",(0,s.jsx)(n.code,{children:".config/tmux/tmux.conf"})]}),"\n",(0,s.jsx)(n.p,{children:"copy the following into .tmux.conf per the tpm instructions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# List of plugins\nset -g @plugin 'tmux-plugins/tpm'\nset -g @plugin 'tmux-plugins/tmux-sensible'\n\n# Other examples:\n# set -g @plugin 'github_username/plugin_name'\n# set -g @plugin 'github_username/plugin_name#branch'\n# set -g @plugin 'git@github.com:user/plugin'\n# set -g @plugin 'git@bitbucket.com:user/plugin'\n\n# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)\nrun '~/.tmux/plugins/tpm/tpm'\n"})}),"\n",(0,s.jsx)(n.p,{children:"Ctrl+X to exit and yes to overwrite and save."}),"\n",(0,s.jsx)(n.p,{children:"Next, resource the config file so it is recognized."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tmux source ~/.tmux.conf\n"})}),"\n",(0,s.jsx)(n.p,{children:"Finally, run tmux"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tmux\n"})}),"\n",(0,s.jsx)(n.h2,{id:"get-into-the-rpi-with-tmux-session",children:"Get into the rpi with tmux session"}),"\n",(0,s.jsx)(n.p,{children:"Now let's get into the rpi thru tmux and do some practice work."}),"\n",(0,s.jsx)(n.p,{children:"From a tmux session that we started above, it should have a solid green bar at the bottom."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"tmux-example",src:t(552).A+"",width:"1660",height:"902"})}),"\n",(0,s.jsx)(n.p,{children:"Let's get into the rpi"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ssh pi@headless.local\n"})}),"\n",(0,s.jsx)(n.p,{children:"Type in the password"}),"\n",(0,s.jsx)(n.p,{children:"To where we are storing the node mounted on the external SSD drive."}),"\n",(0,s.jsx)(n.p,{children:"Now, here's a handy cheatsheet for working with tmux. Open it up."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://tmuxcheatsheet.com/",children:"https://tmuxcheatsheet.com/"})}),"\n",(0,s.jsx)(n.p,{children:"Let's rename this session. You'll have to input this manaully in the keyboard."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ctrl+b"})," then ",(0,s.jsx)(n.code,{children:"$"})," (that's right, ctrl+b, then separately, shift+4)"]}),"\n",(0,s.jsxs)(n.p,{children:["Type in ",(0,s.jsx)(n.code,{children:"ergo-node"})," and hit enter. The bottom green bar should be updated with the name."]}),"\n",(0,s.jsx)(n.p,{children:"To list the sessions:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ctrl+b"})," then ",(0,s.jsx)(n.code,{children:"s"}),". Hit ",(0,s.jsx)(n.code,{children:"q"})," to quit and exit."]}),"\n",(0,s.jsx)(n.p,{children:"If your node is already sync'ing, but you don't see it here, break it."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ctrl+c"})," or ",(0,s.jsx)(n.code,{children:"ctrl+."})]}),"\n",(0,s.jsx)(n.p,{children:"Now, in the terminal window, open a new tab."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"ctrl+t"})}),"\n",(0,s.jsxs)(n.p,{children:["You may have to ssh back in and get back to ",(0,s.jsx)(n.code,{children:"/mnt/hd1"})," directory."]}),"\n",(0,s.jsx)(n.p,{children:"Attach to the tmux ergo-node session. This will be a read-only live view tab."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tmux a -t ergo-node\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Make sure both tabs are in the ",(0,s.jsx)(n.code,{children:"/mnt/hd1"})," directory."]}),"\n",(0,s.jsx)(n.p,{children:"Let's restart the node sync'ing in this tmux ergo-node session to see it live."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"java -jar -Xmx2g ergo-5.0.14.jar --mainnet -c ergo.conf\n"})}),"\n",(0,s.jsx)(n.p,{children:"You should see the node sync'ing in each terminal tab."}),"\n",(0,s.jsx)(n.p,{children:"Now from one of the terminal tabs, detach."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ctrl+b"})," then ",(0,s.jsx)(n.code,{children:"d"})," to detach."]}),"\n",(0,s.jsx)(n.p,{children:"It should reflect your local terminal tab now (exited out)."}),"\n",(0,s.jsx)(n.p,{children:"In the other tab, you should see a live read-only view of the node syncing."}),"\n",(0,s.jsx)(n.p,{children:"Congrats, you are now running the ergo-node sync as a tmux session in the background!"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"tmux-read-only-view",src:t(3338).A+"",width:"921",height:"459"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},552:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/tmux-example-6a7b357038c15f012cf9677a6cf00f38.jpeg"},3338:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/tmux-read-only-screen-b662251fe48a13992079c5f1c9bb2676.jpeg"},4806:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/tmux-youtube-shot-d9eb168805900db66223ccfdeaf97f97.jpeg"},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);