"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[7760],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var i=n.createContext({}),u=function(e){var t=n.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(i.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(r),m=o,h=d["".concat(i,".").concat(m)]||d[m]||p[m]||a;return r?n.createElement(h,l(l({ref:t},c),{},{components:r})):n.createElement(h,l({ref:t},c))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,l=new Array(a);l[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[d]="string"==typeof e?e:o,l[1]=s;for(var u=2;u<a;u++)l[u]=r[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},5162:(e,t,r)=>{r.d(t,{Z:()=>l});var n=r(7294),o=r(6010);const a={tabItem:"tabItem_Ymn6"};function l(e){let{children:t,hidden:r,className:l}=e;return n.createElement("div",{role:"tabpanel",className:(0,o.Z)(a.tabItem,l),hidden:r},t)}},4866:(e,t,r)=>{r.d(t,{Z:()=>w});var n=r(7462),o=r(7294),a=r(6010),l=r(2466),s=r(6775),i=r(1980),u=r(7392),c=r(12);function d(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:r,attributes:n,default:o}}=e;return{value:t,label:r,attributes:n,default:o}}))}function p(e){const{values:t,children:r}=e;return(0,o.useMemo)((()=>{const e=t??d(r);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function m(e){let{value:t,tabValues:r}=e;return r.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:r}=e;const n=(0,s.k6)(),a=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,i._X)(a),(0,o.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(n.location.search);t.set(a,e),n.replace({...n.location,search:t.toString()})}),[a,n])]}function y(e){const{defaultValue:t,queryString:r=!1,groupId:n}=e,a=p(e),[l,s]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=r.find((e=>e.default))??r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:a}))),[i,u]=h({queryString:r,groupId:n}),[d,y]=function(e){let{groupId:t}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,a]=(0,c.Nk)(r);return[n,(0,o.useCallback)((e=>{r&&a.set(e)}),[r,a])]}({groupId:n}),g=(()=>{const e=i??d;return m({value:e,tabValues:a})?e:null})();(0,o.useLayoutEffect)((()=>{g&&s(g)}),[g]);return{selectedValue:l,selectValue:(0,o.useCallback)((e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);s(e),u(e),y(e)}),[u,y,a]),tabValues:a}}var g=r(2389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:t,block:r,selectedValue:s,selectValue:i,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:d}=(0,l.o5)(),p=e=>{const t=e.currentTarget,r=c.indexOf(t),n=u[r].value;n!==s&&(d(t),i(n))},m=e=>{let t=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const r=c.indexOf(e.currentTarget)+1;t=c[r]??c[0];break}case"ArrowLeft":{const r=c.indexOf(e.currentTarget)-1;t=c[r]??c[c.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":r},t)},u.map((e=>{let{value:t,label:r,attributes:l}=e;return o.createElement("li",(0,n.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:p},l,{className:(0,a.Z)("tabs__item",f.tabItem,l?.className,{"tabs__item--active":s===t})}),r??t)})))}function k(e){let{lazy:t,children:r,selectedValue:n}=e;const a=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===n));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function v(e){const t=y(e);return o.createElement("div",{className:(0,a.Z)("tabs-container",f.tabList)},o.createElement(b,(0,n.Z)({},e,t)),o.createElement(k,(0,n.Z)({},e,t)))}function w(e){const t=(0,g.Z)();return o.createElement(v,(0,n.Z)({key:String(t)},e))}},5214:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>u,toc:()=>d});var n=r(7462),o=(r(7294),r(3905)),a=r(4866),l=r(5162);const s={description:"This section will help with understanding the relay and block producer topology."},i="Basic Stake Pool Networking",u={unversionedId:"stake-pool-guides/basic-stake-pool-networking",id:"stake-pool-guides/basic-stake-pool-networking",title:"Basic Stake Pool Networking",description:"This section will help with understanding the relay and block producer topology.",source:"@site/docs/stake-pool-guides/basic-stake-pool-networking.md",sourceDirName:"stake-pool-guides",slug:"/stake-pool-guides/basic-stake-pool-networking",permalink:"/docs/stake-pool-guides/basic-stake-pool-networking",draft:!1,editUrl:"https://github.com/armada-alliance/docs/edit/master/docs/stake-pool-guides/basic-stake-pool-networking.md",tags:[],version:"current",frontMatter:{description:"This section will help with understanding the relay and block producer topology."},sidebar:"tutorialSidebar",previous:{title:"Securing Stakepool Connections & Monitoring with Tailscale",permalink:"/docs/stake-pool-guides/monitor-alert"},next:{title:"Wireguard Guide",permalink:"/docs/stake-pool-guides/wireguard-guide"}},c={},d=[{value:"Assumptions",id:"assumptions",level:2},{value:"Overview",id:"overview",level:2},{value:"CUSTOM_PEERS=&quot;10.20.30.3**:<strong>6000</strong>|<strong>138.197.71.216</strong>:**6000&quot;",id:"custom_peers10203036000138197712166000",level:4},{value:"Pool Registration",id:"pool-registration",level:2},{value:"DNS Client",id:"dns-client",level:2},{value:"DNS Client Examples",id:"dns-client-examples",level:3}],p={toc:d},m="wrapper";function h(e){let{components:t,...r}=e;return(0,o.kt)(m,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"basic-stake-pool-networking"},"Basic Stake Pool Networking"),(0,o.kt)("h2",{id:"assumptions"},"Assumptions"),(0,o.kt)("p",null,"For the sake of this tutorial we are assuming that the Raspberry Pi nodes you are running are in your home and connected to either your ISP's internet router or a separate switch connected to your ISP's internet router. Your nodes should have a firewall configured with as few ports open as possible and with your firewall rules as specific as possible. Furthermore, your ISP's internet router should also have firewall settings configured. If you are not familiar with them, leaving the firewall defaults from your ISP are generally okay."),(0,o.kt)("p",null,"If you have a block producer running, at a minimum it's firewall rules should have it's node port available only to your configured relay IPs and then the port you use for ssh. If you want to monitor your block producer metrics using Grafana, you'll also need to provide access to the Grafana port. Same thing if you want to monitor your relays."),(0,o.kt)("p",null,"We are not network experts here. This is only provided as a point of general understanding of how the node topology and network interact."),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Your ",(0,o.kt)("strong",{parentName:"p"},"relay nodes")," should be pointed to other remote relay nodes and your block producer. Your ",(0,o.kt)("strong",{parentName:"p"},"block producer")," should only be pointing to your relay nodes."),(0,o.kt)(a.Z,{mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"relay node",label:"Relay Node",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="mainnet-topology.json"',title:'"mainnet-topology.json"'},'{\n  "Producers": [\n    {\n      "addr": "block producers private IPv4",\n      "port": 6000,\n      "valency": 1\n    },\n    {\n      "addr": "138.197.71.216",\n      "port": 3001,\n      "valency": 1\n    },\n    {\n      "addr": "107.23.17.23",\n      "port": 3001,\n      "valency": 1\n    },\n    {\n      "addr": "3.140.154.176",\n      "port": 6002,\n      "valency": 1\n    }\n  ]\n}\n'))),(0,o.kt)(l.Z,{value:"block producer",label:"Block Producer",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="mainnet-topology.json"',title:'"mainnet-topology.json"'},'{\n  "Producers": [\n    {\n      "addr": "10.20.30.1",\n      "port": 6001,\n      "valency": 1\n    },\n    {\n      "addr": "10.20.30.2",\n      "port": 6002,\n      "valency": 1\n    }\n  ]\n}\n')))),(0,o.kt)("p",null,"The ",(0,o.kt)("strong",{parentName:"p"},"addr")," and ",(0,o.kt)("strong",{parentName:"p"},"port")," entries above should be the IP addresses of your relay nodes. That's it. Your block producer should have firewall entries restricting access to only these IP addresses on the port you are running your block producer on. Example ufw firewall status below running the block producer on port 6000."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=" sudo ufw status"',title:'"',sudo:!0,ufw:!0,'status"':!0},"To                         Action      From\n--                         ------      ----\n6000/tcp                   ALLOW       10.20.30.1\n6000/tcp                   ALLOW       10.20.30.2\n")),(0,o.kt)("p",null,"The first example ",(0,o.kt)("strong",{parentName:"p"},"addr")," line above ",(0,o.kt)("strong",{parentName:"p"},"10.20.30.3")," is your block producer's IP address and ",(0,o.kt)("strong",{parentName:"p"},"port 6000")," is the port you are running your block producer on. This object should be the exact same on your other relays."),(0,o.kt)("p",null,"The other three objects are remote peers. You can set those manually or you can use the ",(0,o.kt)("strong",{parentName:"p"},"topologyUpdater.sh")," script from Guild operators. If you choose to use the topologyUpdater.sh be sure you set the ",(0,o.kt)("strong",{parentName:"p"},"CUSTOM","_","PEERS")," line in the script correctly before you run it. This is a pipe-delimited set of addr:port:valency pairs of peers that you want the script to add to your final topology.json file. This line should include your block producer. Default valency is 1 (one) if not specified. Example showing the first two objects from the mainnet-topology.json file above:"),(0,o.kt)("h4",{id:"custom_peers10203036000138197712166000"},"CUSTOM","_",'PEERS="10.20.30.3',"*","*",":",(0,o.kt)("strong",{parentName:"h4"},"6000"),"|",(0,o.kt)("strong",{parentName:"h4"},"138.197.71.216"),":","*","*",'6000"'),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Set ",(0,o.kt)("strong",{parentName:"p"},"valency")," to 0 (zero) to disable a remote peer if you do not wish to delete the peer entirely from the file.")),(0,o.kt)("h2",{id:"pool-registration"},"Pool Registration"),(0,o.kt)("p",null,"When you create your stake pool's ",(0,o.kt)("strong",{parentName:"p"},"pool.json")," metadata file you will notice a section called ",(0,o.kt)("strong",{parentName:"p"},"poolRelays"),". This is where you would add ",(0,o.kt)("strong",{parentName:"p"},"public")," relays, visible to others. You can add them as static IPs or as a domain name, such as ",(0,o.kt)("strong",{parentName:"p"},"north.acme.com"),". If you are running more than one relay on your internal network you will need to have them assigned to different ports, such as 6001 and 6002."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="pool.json"',title:'"pool.json"'},'"poolRelays": [\n    {\n      "relayType": "dns",\n      "relayEntry": "north.acme.com",\n      "relayPort": "6001"\n    },\n    {\n      "relayType": "dns",\n      "relayEntry": "north.acme.com",\n      "relayPort": "6002"\n    }\n  ],\n')),(0,o.kt)("p",null,"A typical home network will only expose a single external IP address to the world, dynamically assigned by your ISP (Internet Service Provider). Dynamically assigned external IP leases can be relatively static for a good long period, but this is not guaranteed and you should consider registering a domain name so you can use dns entries in the pool.json instead. Otherwise, each time your external IP address changes you'll have to re-register your pool with a new IP for your relays."),(0,o.kt)("h2",{id:"dns-client"},"DNS Client"),(0,o.kt)("p",null,"Unless you have a static IP address assigned by your ISP, at some point you're going to have to consider setting up a dynamic DNS client that runs on your internal network and broadcasts your external IP address assigned by your ISP to your dynamic dns domain provider, such as Google domains. Then whenever your ISP changes your external dynamic IP address, your DNS client will see that, push the new IP address to your domain provider and there should be next to no impact to your domain addresses."),(0,o.kt)("h3",{id:"dns-client-examples"},"DNS Client Examples"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://support.google.com/domains/answer/6147083?hl=en"},"ddclient")),(0,o.kt)("li",{parentName:"ul"},"no-ip"),(0,o.kt)("li",{parentName:"ul"},"namecheap.com openwrt ddns-scripts")),(0,o.kt)("p",null,"Was this information helpful? Earn rewards with us! ",(0,o.kt)("a",{parentName:"p",href:"/docs/delegate"},"Consider delegating some ADA"),"."))}h.isMDXComponent=!0}}]);