"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[5016],{6245:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var r=o(4848),t=o(8453);const a={description:"Running a Cardano full node with a Docker image"},i="Cardano Node Docker Image for ARM64 devices \ud83d\udc33",s={id:"stake-pool-guides/docker-pool-guide",title:"Cardano Node Docker Image for ARM64 devices \ud83d\udc33",description:"Running a Cardano full node with a Docker image",source:"@site/docs/stake-pool-guides/docker-pool-guide.md",sourceDirName:"stake-pool-guides",slug:"/stake-pool-guides/docker-pool-guide",permalink:"/docs/stake-pool-guides/docker-pool-guide",draft:!1,unlisted:!1,editUrl:"https://github.com/armada-alliance/docs/edit/master/docs/stake-pool-guides/docker-pool-guide.md",tags:[],version:"current",frontMatter:{description:"Running a Cardano full node with a Docker image"},sidebar:"tutorialSidebar",previous:{title:"Oracle Cloud Ampere",permalink:"/docs/stake-pool-guides/oracle-ampere"},next:{title:"Stake Pool Ops",permalink:"/docs/pool-ops/"}},d={},c=[{value:"Why using docker image to run a Cardano node?",id:"why-using-docker-image-to-run-a-cardano-node",level:2},{value:"System requirements",id:"system-requirements",level:2},{value:"3.1. Pull the built docker image",id:"31-pull-the-built-docker-image",level:2},{value:"3.2. Build the docker image",id:"32-build-the-docker-image",level:2},{value:"Check the running status of the docker container",id:"check-the-running-status-of-the-docker-container",level:2},{value:"Stop/Restart/Delete the Docker Cardano node",id:"stoprestartdelete-the-docker-cardano-node",level:2},{value:"Monitor the Docker Cardano node with gLiveView",id:"monitor-the-docker-cardano-node-with-gliveview",level:2},{value:"Check the scheduled slots of the block production node",id:"check-the-scheduled-slots-of-the-block-production-node",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"cardano-node-docker-image-for-arm64-devices-",children:"Cardano Node Docker Image for ARM64 devices \ud83d\udc33"}),"\n",(0,r.jsx)(n.p,{children:"In this project you will find the instructions to build a docker image on Linux containing all the needed files to run a Cardano full node.\nThe docker image can run on any arm64 device such as a Mac Mini M1. The node can be configured as a relay or block production node."}),"\n",(0,r.jsx)(n.h2,{id:"why-using-docker-image-to-run-a-cardano-node",children:"Why using docker image to run a Cardano node?"}),"\n",(0,r.jsx)(n.p,{children:"The advantage of deploying a Cardano node as a Docker image is, that it can be installed seamlessly and launched right out of the box.\nIf you ever decide to remove it, you only have to delete one file - the image. Another advantage is that the created image can run on any\noperating system where Docker is installed. Using our Docker image reduces the complexity and effort of setting up a Cardano node compared to the traditional way\n(for example, you don't have to deal with systemd settings)."}),"\n",(0,r.jsx)(n.h2,{id:"system-requirements",children:"System requirements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CPU: ARM64 processor min 2 cores at 2GHz or faster."}),"\n",(0,r.jsx)(n.li,{children:"Memory: 24GB of RAM."}),"\n",(0,r.jsx)(n.li,{children:"Storage: 150 GB."}),"\n",(0,r.jsx)(n.li,{children:"OS: Linux (recommended Ubuntu)"}),"\n",(0,r.jsx)(n.li,{children:"Additional Software: Docker"}),"\n",(0,r.jsx)(n.li,{children:"Broadband: 10 Mbps +"}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"1install-docker",children:"1.Install Docker"}),"\n",(0,r.jsx)(n.p,{children:"The installation of Docker varies from operating system to operating system. For this reason, we share some helpful and good installation\nguide links for the different operating systems."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/speedwing/cardano-staking-pool-edu/blob/master/DOCKER.md",children:"Install Docker on Linux (Ubuntu)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.docker.com/desktop/mac/install/",children:"Install Docker on MacOs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.docker.com/desktop/windows/install/",children:"Install Docker on Windows"})}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"2-set-up-the-environment--download-files",children:"2. Set-up the Environment & Download Files"}),"\n",(0,r.jsx)(n.p,{children:"Create the repositories on your host system first. They will hold the files to build the docker image as well as the Cardano node configuration files."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd ${HOME}\nsudo mkdir Cardano-node-docker\ncd Cardano-node-docker\nsudo mkdir -p node/db && sudo mkdir -p node/files && sudo mkdir -p dockerfiles/files\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The files to build the docker images will be downloaded from ",(0,r.jsx)(n.a,{href:"https://github.com/jterrier84/Cardano-node-docker",children:"MINI1 pool GitHub"})]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"\u26a0\ufe0f If there's a newer version of the cardano-node released, you may have to fork and manually update jterrier84's Cardano-node-docker repo (build.sh and run.sh files) -- Or open an Issue."})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd dockerfiles\nsudo wget -N https://raw.githubusercontent.com/jterrier84/Cardano-node-docker/master/dockerfiles/armada-cn-arm64.dockerfile\nsudo wget -N https://raw.githubusercontent.com/jterrier84/Cardano-node-docker/master/dockerfiles/build.sh\nsudo chmod +x build.sh\ncd files\nsudo wget -N https://raw.githubusercontent.com/jterrier84/Cardano-node-docker/master/dockerfiles/files/run.sh\nsudo wget -N https://raw.githubusercontent.com/jterrier84/Cardano-node-docker/master/dockerfiles/files/tx-submit-service\nsudo chmod +x run.sh\nsudo chmod +x tx-submit-service\ncd ${HOME}/Cardano-node-docker/node\nsudo wget -N https://raw.githubusercontent.com/jterrier84/Cardano-node-docker/master/node/run-node.sh\nsudo chmod +x run-node.sh\n"})}),"\n",(0,r.jsx)(n.p,{children:"Download the latest official Cardano node configuration files from the IOHK repository and store them on our host system."}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:'For the sake of this tutorial we will download and set up the configuration files for the Cardano testnet/preprod. If you need the files for the mainnet\njust replace "preprod" with "mainnet" here below.'})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"As the configuration files might require modifications over time, it is way more practical to have them stored on the host,\nrather than have them stored inside the Docker container. Our Cardano Docker node will have access to these files from the container."})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'cd ${HOME}/Cardano-node-docker/node/files\nexport NODE_CONFIG="preprod"\nsudo curl -O -J https://book.world.dev.cardano.org/environments/${NODE_CONFIG}/config.json && sudo mv config.json ${NODE_CONFIG}-config.json\nsudo curl -O -J https://book.world.dev.cardano.org/environments/${NODE_CONFIG}/db-sync-config.json\nsudo curl -O -J https://book.world.dev.cardano.org/environments/${NODE_CONFIG}/submit-api-config.json\nsudo curl -O -J https://book.world.dev.cardano.org/environments/${NODE_CONFIG}/topology.json && sudo mv topology.json ${NODE_CONFIG}-topology.json\nsudo curl -O -J https://book.world.dev.cardano.org/environments/${NODE_CONFIG}/byron-genesis.json\nsudo curl -O -J https://book.world.dev.cardano.org/environments/${NODE_CONFIG}/shelley-genesis.json\nsudo curl -O -J https://book.world.dev.cardano.org/environments/${NODE_CONFIG}/alonzo-genesis.json\nsudo curl -O -J https://book.world.dev.cardano.org/environments/${NODE_CONFIG}/conway-genesis.json\nsudo wget -O tx-submit-mainnet-config.yaml https://raw.githubusercontent.com/input-output-hk/cardano-node/master/cardano-submit-api/config/tx-submit-mainnet-config.yaml\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The directory /files contains the Cardano node configuration files."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The directory /db will host the Cardano blockchain once the Docker node is started. It is important that the blockchain data\nare stored on the host system and not inside the Docker container, otherwise the entire blockchain would be deleted every time\nthe Docker container is removed."}),"\n"]}),"\n"]})}),"\n",(0,r.jsx)(n.h1,{id:"3-the-armada-node-docker-image",children:"3. The Armada Node Docker Image"}),"\n",(0,r.jsx)(n.p,{children:"Now it's time to create the docker image. There are two ways to do this."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Pull the pre-built docker image from our Armada Docker Hub repository (easiest and fastest option) (go to chapter 3.1)"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Build the docker image by yourself (go to chapter 3.2)"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Either way, the docker image includes:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["cardano-node & cardano-cli (latest version) - Cardano binaries to run the node (Download compiled binaries from ",(0,r.jsx)(n.a,{href:"https://github.com/armada-alliance/cardano-node-binaries",children:"Armada Alliance GitHub"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"gLiveView - Monitoring tool for the Cardano node"}),"\n",(0,r.jsxs)(n.li,{children:["YaLL - Tool to query the scheduled slots for a block production node. (Credits for this tool goes to ",(0,r.jsx)(n.a,{href:"https://github.com/asnakep/YaLL.git",children:"SNAKE POOL"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Cardano Submit Transaction API - API to connect with a Cardano wallet (e.g. Nami) to send transactions via your own full node"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"31-pull-the-built-docker-image",children:"3.1. Pull the built docker image"}),"\n",(0,r.jsx)(n.p,{children:"Pull the image with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker pull armadaalliance/armada-cn:8.9.3\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see your Cardano node docker image in the list:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker images\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"REPOSITORY              TAG            IMAGE ID       CREATED          SIZE\narmadaalliance/armada-cn        8.9.3         da4414775ce6   37 seconds ago   700MB\n"})}),"\n",(0,r.jsx)(n.p,{children:"You can now proceed with chapter 4, in order to start the node."}),"\n",(0,r.jsx)(n.h2,{id:"32-build-the-docker-image",children:"3.2. Build the docker image"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd ${HOME}/Cardano-node-docker/dockerfiles\nsudo ./build.sh\n"})}),"\n",(0,r.jsx)(n.p,{children:"The process might take some minutes."}),"\n",(0,r.jsx)(n.p,{children:"Once the process is done, you can use the command to see the list of all Docker images on your host system:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"docker images\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see your Cardano node docker image in the list, e.g."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"REPOSITORY              TAG            IMAGE ID       CREATED          SIZE\narmadaalliance/armada-cn        8.9.3         da4414775ce6   37 seconds ago   700MB\n<none>                  <none>         f3891eef21e4   3 minutes ago    1.09GB\n"})}),"\n",(0,r.jsx)(n.p,{children:'All we need is the "armada/armada-cn" image. You can delete the others in the list to free up space on your harddrive, e.g.'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"docker rmi f3891eef21e4 \n"})}),"\n",(0,r.jsx)(n.h1,{id:"4-start-node",children:"4. Start node"}),"\n",(0,r.jsx)(n.p,{children:"Let's first configure the run-node.sh script to match your host system environment."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd ${HOME}/Cardano-node-docker/node\nsudo nano run-node.sh\n"})}),"\n",(0,r.jsx)(n.p,{children:"Edit the configuration section according to your setup."}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"If you are running the node as relay node, you can ignore the paramter CN_KEY_PATH."})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"Important: Change the directory paths CN_CONFIG_PATH and CN_DB_PATH to the corresponding locations on your host."})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'##Configuration for relay and block producing node\nCNIMAGENAME="armada/armada-cn"                                   ## Name of the Cardano docker image\nCNVERSION="8.9.3"                                                ## Version of the cardano-node. It must match with the version of the docker i>\nCNNETWORK="preprod"                                              ## Use "mainnet" if connecting node to the mainnet\nCNMODE="relay"                                                   ## Use "bp" if you configure the node as block production node\nCNPORT="3001"                                                    ## Define the port of the node\nCNPROMETHEUS_PORT="12799"                                        ## Define the port for the Prometheus metrics\nCN_CONFIG_PATH="/home/julienterrier/Cardano-node-docker/node/files" ## Path to the folder where the Cardano config files are stored on the host>\nCN_DB_PATH="/home/julienterrier/Cardano-node-docker/node/db"     ## Path to the folder where the Cardano database (blockchain) will be stored o>\nCN_RTS_OPTS="+RTS -N2 -I0.1 -Iw3600 -A64m -AL128M -n4m -F1.1 -H3500M -O3500M -RTS"      ## RTS optimization parameters\nCN_BF_ID=""                                                      ## Your blockfrost.io project ID (for ScheduledBlock script)\nCN_POOL_ID=""                                                    ## Your stake pool ID (for ScheduledBlock script)\nCN_POOL_TICKER=""                                                ## Your pool ticker (for ScheduledBlock script)\nCN_VRF_SKEY_PATH=""                                              ## Name of the vrf.skey file. It must be located in the same directory as CN_KEY_PATH (for ScheduledBlock script)\nCN_KEY_PATH=""                                                   ## Path to the folder where the OP certificate and keys are stored on the host system (for block production node only)\n'})}),"\n",(0,r.jsx)(n.p,{children:"After making the changes, save and close the file."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Ctrl+o & ENTER & Ctrl+x"})}),"\n",(0,r.jsx)(n.p,{children:"You can now run the docker image."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo ./run-node.sh\n"})}),"\n",(0,r.jsx)(n.h2,{id:"check-the-running-status-of-the-docker-container",children:"Check the running status of the docker container"}),"\n",(0,r.jsx)(n.p,{children:"You can check the running status of the docker container at any time with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"docker ps -a\n"})}),"\n",(0,r.jsx)(n.p,{children:"If the docker node started successfully, you might see something like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'CONTAINER ID   IMAGE                     COMMAND                  CREATED          STATUS                    PORTS                                                                                      NAMES\nfed0cfbf7d86   armadaalliance/armada-cn:8.9.3   "bash title=">_ Terminal" -c /home/carda\u2026"   12 seconds ago   Up 10 seconds (healthy)   0.0.0.0:3001->3001/tcp, :::3001->3001/tcp, 0.0.0.0:12799->12798/tcp, :::12799->12798/tcp   cardano-node-testnet-1.34.1\n'})}),"\n",(0,r.jsx)(n.p,{children:"You can also check the logs of the running cardano-node:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"docker logs -f {CONTAINER ID}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To exit the logs press ",(0,r.jsx)(n.code,{children:"Ctrl+c"})]}),"\n",(0,r.jsx)(n.h2,{id:"stoprestartdelete-the-docker-cardano-node",children:"Stop/Restart/Delete the Docker Cardano node"}),"\n",(0,r.jsx)(n.p,{children:"To stop the running Cardano node execute:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"docker stop {CONTAINER ID}\n"})}),"\n",(0,r.jsx)(n.p,{children:"A stopped container can be started again with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"docker start {CONTAINER ID}\n"})}),"\n",(0,r.jsx)(n.p,{children:"A stopped container can also be deleted. Once deleted, it can not be started with the command above again."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"docker rm {CONTAINER ID}\n"})}),"\n",(0,r.jsx)(n.p,{children:"If you like to start the node again, after having removed the docker container, just run the run-node.sh script."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo ${HOME}/Cardano-node-docker/node/run-node.sh\n"})}),"\n",(0,r.jsx)(n.h2,{id:"monitor-the-docker-cardano-node-with-gliveview",children:"Monitor the Docker Cardano node with gLiveView"}),"\n",(0,r.jsx)(n.p,{children:"While the docker Cardano node is running, you can monitor its status with the tool gLiveView."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"docker exec -it {CONTAINER ID} /home/cardano/pi-pool/scripts/gLiveView.sh\n"})}),"\n",(0,r.jsx)(n.h2,{id:"check-the-scheduled-slots-of-the-block-production-node",children:"Check the scheduled slots of the block production node"}),"\n",(0,r.jsxs)(n.p,{children:["Our Docker image contains the poolLeaderLogs python script from ",(0,r.jsx)(n.a,{href:"https://github.com/asnakep/poolLeaderLogs",children:"SNAKE pool"}),". This tool allows to\nquery the blockchain for the scheduled slots for your block production node."]}),"\n",(0,r.jsx)(n.p,{children:"Before using the script, make sure that the right configurations are set in our shell script run-node.sh. Set the following variables:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'CN_POOL_ID="c3e7025ebae638e994c149e5703e82619b31897c9e1d64fc684f81c2"   ## Your stake pool ID (for poolLeaderLogs script)\nCN_POOL_TICKER="MINI1"                                                  ## Your pool ticker (for poolLeaderLogs script)\nCN_VRF_SKEY_PATH="poolLeaderLogs.vrf.skey"                                        ## Name of the vrf.skey file. It must be located in the same directory as CN_KEY_PATH (for ScheduledBlock script)\nCN_KEY_PATH="/home/julienterrier/Cardano-node-docker/node/files/.keys"  ## Path to the folder where the OP certificate and keys are stored on the host system\n'})}),"\n",(0,r.jsx)(n.p,{children:"Start the poolLeaderLogs.py script and follow the instructions on the terminal:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"docker exec -it {CONTAINER ID} python3 /home/cardano/pi-pool/scripts/ScheduledBlocks/poolLeaderLogs.py\n"})}),"\n",(0,r.jsx)(n.h1,{id:"run-node-in-p2p-peer-to-peer-mode",children:"Run node in P2P (peer-to-peer) mode"}),"\n",(0,r.jsxs)(n.p,{children:["To run your node in the P2P mode, please follow the instructions from the ",(0,r.jsx)(n.a,{href:"https://armada-alliance.com/docs/stake-pool-guides/p2p-networking",children:"Armada-Alliance Docs page"})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>s});var r=o(6540);const t={},a=r.createContext(t);function i(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);