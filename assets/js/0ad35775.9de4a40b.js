"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[9085],{1949:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=n(4848),o=n(8453);const i={},r="Update Pools Registration Certificate",l={id:"stake-pool-guides/pi-pool-tutorial/update-registration-cert",title:"Update Pools Registration Certificate",description:"Query the chain for protocol parameters, store them in a file named params.json.",source:"@site/docs/stake-pool-guides/pi-pool-tutorial/update-registration-cert.md",sourceDirName:"stake-pool-guides/pi-pool-tutorial",slug:"/stake-pool-guides/pi-pool-tutorial/update-registration-cert",permalink:"/docs/stake-pool-guides/pi-pool-tutorial/update-registration-cert",draft:!1,unlisted:!1,editUrl:"https://github.com/armada-alliance/docs/edit/master/docs/stake-pool-guides/pi-pool-tutorial/update-registration-cert.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Rotate KES",permalink:"/docs/stake-pool-guides/pi-pool-tutorial/rotate-kes"},next:{title:"CNCLI Leader Logs",permalink:"/docs/stake-pool-guides/leader-logs"}},s={},c=[{value:"Create a new pool certificate",id:"create-a-new-pool-certificate",level:2}];function d(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"update-pools-registration-certificate",children:"Update Pools Registration Certificate"}),"\n",(0,a.jsx)(t.p,{children:"Query the chain for protocol parameters, store them in a file named params.json."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Core"',children:"cd ${NODE_HOME}\ncardano-cli query protocol-parameters \\\n  --${CONFIG_NET} \\\n  --out-file $NODE_HOME/params.json\n"})}),"\n",(0,a.jsx)(t.p,{children:"If you plan to edit your poolMetaData.json file do so now, run the below command and move poolMetaDataHash.txt to your cold machine. If your poolMetaData.json is not being edited head over to your cold machine."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Core"',children:"cardano-cli stake-pool metadata-hash \\\n  --pool-metadata-file poolMetaData.json > poolMetaDataHash.txt\n"})}),"\n",(0,a.jsx)(t.h2,{id:"create-a-new-pool-certificate",children:"Create a new pool certificate"}),"\n",(0,a.jsx)(t.admonition,{type:"danger",children:(0,a.jsx)(t.p,{children:"--metadata-url must be 64 characters or less."})}),"\n",(0,a.jsx)(t.p,{children:"Open or create a file name registration-cert.txt. Use this file to edit the below command before you issue it. It's also handy to leave this file on the cold machine for any future edits. Below is 1,000 ada pledge, 340 cost and a 1% margin. Refer back to the core guide if you are using more than one relay."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Cold Offline"',children:"cd ${NODE_HOME}\nnano registration-cert.txt\n"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Cold Offline"',children:"cardano-cli stake-pool registration-certificate \\\n  --cold-verification-key-file ${HOME}/cold-keys/node.vkey \\\n  --vrf-verification-key-file vrf.vkey \\\n  --pool-pledge 10000000000 \\\n  --pool-cost 340000000 \\\n  --pool-margin 0.01 \\\n  --pool-reward-account-verification-key-file stake.vkey \\\n  --pool-owner-stake-verification-key-file stake.vkey \\\n  --${CONFIG_NET} \\\n  --single-host-pool-relay <r1.example.com> \\\n  --pool-relay-port 3001 \\\n  --metadata-url <https://example.com/poolMetaData.json> \\\n  --metadata-hash $(cat poolMetaDataHash.txt) \\\n  --out-file pool.cert\n"})}),"\n",(0,a.jsx)(t.p,{children:"Once you are satisfied with your edits copy the command, save the file and issue it in your terminal."}),"\n",(0,a.jsxs)(t.p,{children:["Issue a delegation certificate from ",(0,a.jsx)(t.strong,{children:"stake.skey"})," & ",(0,a.jsx)(t.strong,{children:"node.vkey"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Cold Offline"',children:"cardano-cli stake-address delegation-certificate \\\n  --stake-verification-key-file stake.vkey \\\n  --cold-verification-key-file ${HOME}/cold-keys/node.vkey \\\n  --out-file deleg.cert\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Move ",(0,a.jsx)(t.strong,{children:"pool.cert"}),", ",(0,a.jsx)(t.strong,{children:"deleg.cert"})," to your online core machine."]}),"\n",(0,a.jsx)(t.p,{children:"Query the current slot number or tip of the chain."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Core"',children:"slotNo=$(cardano-cli query tip --${CONFIG_NET} | jq -r '.slot')\necho slotNo: ${slotNo}\n"})}),"\n",(0,a.jsx)(t.p,{children:"Query the wallets utxo history and build variables for a transaction."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Core"',children:'cardano-cli query utxo --address $(cat payment.addr) --${CONFIG_NET} > fullUtxo.out\n\ntail -n +3 fullUtxo.out | sort -k3 -nr > balance.out\n\ncat balance.out\n\ntx_in=""\ntotal_balance=0\nwhile read -r utxo; do\n  in_addr=$(awk \'{ print $1 }\' <<< "${utxo}")\n  idx=$(awk \'{ print $2 }\' <<< "${utxo}")\n  utxo_balance=$(awk \'{ print $3 }\' <<< "${utxo}")\n  total_balance=$((${total_balance}+${utxo_balance}))\n  echo TxHash: ${in_addr}#${idx}\n  echo ADA: ${utxo_balance}\n  tx_in="${tx_in} --tx-in ${in_addr}#${idx}"\ndone < balance.out\ntxcnt=$(cat balance.out | wc -l)\necho Total ADA balance: ${total_balance}\necho Number of UTXOs: ${txcnt}\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Build temporary ",(0,a.jsx)(t.strong,{children:"tx.tmp"})," to hold information while we build our raw transaction file."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Core"',children:"cardano-cli transaction build-raw \\\n  ${tx_in} \\\n  --tx-out $(cat payment.addr)+${total_balance} \\\n  --invalid-hereafter $(( ${currentSlot} + 10000)) \\\n  --fee 0 \\\n  --certificate-file pool.cert \\\n  --certificate-file deleg.cert \\\n  --out-file tx.tmp\n"})}),"\n",(0,a.jsx)(t.p,{children:"Calculate the transaction fee."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Core"',children:"fee=$(cardano-cli transaction calculate-min-fee \\\n  --tx-body-file tx.tmp \\\n  --tx-in-count ${txcnt} \\\n  --tx-out-count 1 \\\n  --${CONFIG_NET} \\\n  --witness-count 3 \\\n  --byron-witness-count 0 \\\n  --protocol-params-file params.json | awk '{ print $1 }')\n  echo fee: ${fee}\n"})}),"\n",(0,a.jsx)(t.p,{children:"Calculate output that comes back to you (change)."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Core"',children:"txOut=$((${total_balance}-${fee}))\necho txOut: ${txOut}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Build your ",(0,a.jsx)(t.strong,{children:"tx.raw"})," (unsigned) transaction file."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Core"',children:"cardano-cli transaction build-raw \\\n  ${tx_in} \\\n  --tx-out $(cat payment.addr)+${txOut} \\\n  --invalid-hereafter $(( ${slotNo} + 10000)) \\\n  --fee ${fee} \\\n  --certificate-file pool.cert \\\n  --certificate-file deleg.cert \\\n  --out-file tx.raw\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Move ",(0,a.jsx)(t.strong,{children:"tx.raw"})," to your cold offline machine."]}),"\n",(0,a.jsxs)(t.p,{children:["Sign the transaction with your ",(0,a.jsx)(t.strong,{children:"payment.skey"}),", ",(0,a.jsx)(t.strong,{children:"node.skey"})," & ",(0,a.jsx)(t.strong,{children:"stake.skey"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Cold Offline"',children:"cardano-cli transaction sign \\\n  --tx-body-file tx.raw \\\n  --signing-key-file payment.skey \\\n  --signing-key-file ${HOME}/cold-keys/node.skey \\\n  --signing-key-file stake.skey \\\n  --${CONFIG_NET} \\\n  --out-file tx.signed\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Move ",(0,a.jsx)(t.strong,{children:"tx.signed"})," back to your core node & submit the transaction to the blockchain."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Core"',children:"cardano-cli transaction submit \\\n  --tx-file tx.signed \\\n  --${CONFIG_NET}\n"})}),"\n",(0,a.jsx)(t.p,{children:"If you lower your pledge you need to wait two epochs before you can remove the ada or your pledge will show as unmet and you will be assigned and forge blocks but neither you nor your delegators will be paid."})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>l});var a=n(6540);const o={},i=a.createContext(o);function r(e){const t=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);