"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[7387],{3714:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=s(4848),t=s(8453);const i={},r="Apple M1 Asahi Linux",l={id:"stake-pool-guides/m1-asahi-linux",title:"Apple M1 Asahi Linux",description:"Prerequisites",source:"@site/docs/stake-pool-guides/m1-asahi-linux.md",sourceDirName:"stake-pool-guides",slug:"/stake-pool-guides/m1-asahi-linux",permalink:"/docs/stake-pool-guides/m1-asahi-linux",draft:!1,unlisted:!1,editUrl:"https://github.com/armada-alliance/docs/edit/master/docs/stake-pool-guides/m1-asahi-linux.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Apple Silicon",permalink:"/docs/apple-silicon"},next:{title:"Apple M1 macOS",permalink:"/docs/stake-pool-guides/apple-m1-guide/"}},o={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Start by installing Asahi Linux by following the link below",id:"start-by-installing-asahi-linux-by-following-the-link-below",level:3},{value:"Defaults: alarm/alarm &amp; root/root.",id:"defaults-alarmalarm--rootroot",level:4},{value:"Update the system",id:"update-the-system",level:3},{value:"Log in and change default passwords",id:"log-in-and-change-default-passwords",level:3},{value:"Bash completion",id:"bash-completion",level:2},{value:"Locales",id:"locales",level:2},{value:"Time",id:"time",level:2},{value:"Chrony",id:"chrony",level:2},{value:"Packages",id:"packages",level:2},{value:"zram swap",id:"zram-swap",level:2},{value:"Prometheus",id:"prometheus",level:2},{value:"Yay AUR package manager",id:"yay-aur-package-manager",level:2},{value:"Grafana-bin AUR",id:"grafana-bin-aur",level:3},{value:"Static ip",id:"static-ip",level:2},{value:"Hostname",id:"hostname",level:2},{value:"Server setup",id:"server-setup",level:2},{value:"sysctl",id:"sysctl",level:2},{value:"Disable the root user",id:"disable-the-root-user",level:3},{value:"Secure shared memory",id:"secure-shared-memory",level:3},{value:"Increase open file limit for $USER",id:"increase-open-file-limit-for-user",level:3},{value:"Environment setup",id:"environment-setup",level:2},{value:"Create bash variables &amp; add ~/.local/bin to our $PATH \ud83c\udfc3",id:"create-bash-variables--add-localbin-to-our-path-",level:3},{value:"Retrieve node files",id:"retrieve-node-files",level:3},{value:"Build Libsodium",id:"build-libsodium",level:2},{value:"Build secp256k1",id:"build-secp256k1",level:2},{value:"blst",id:"blst",level:2},{value:"LLVM 12.0.1",id:"llvm-1201",level:2},{value:"ncurses5 compat libs",id:"ncurses5-compat-libs",level:2},{value:"GHCUP, GHC &amp; Cabal",id:"ghcup-ghc--cabal",level:2},{value:"Obtain cardano-node",id:"obtain-cardano-node",level:3},{value:"Systemd unit startup scripts",id:"systemd-unit-startup-scripts",level:3},{value:"gLiveView.sh",id:"gliveviewsh",level:2},{value:"Install Cronie",id:"install-cronie",level:2},{value:"topologyUpdater.sh (not needed on block producer)",id:"topologyupdatersh-not-needed-on-block-producer",level:2},{value:"Add save and exit",id:"add-save-and-exit",level:3},{value:"Display inbound connections in Grafana",id:"display-inbound-connections-in-grafana",level:2},{value:"System updates",id:"system-updates",level:2},{value:"Firewall",id:"firewall",level:2},{value:"Wireless",id:"wireless",level:2},{value:"Usefull links",id:"usefull-links",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"apple-m1-asahi-linux",children:"Apple M1 Asahi Linux"}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.p,{children:["Asahi Arch Linux, minimal or desktop installed on your M1 or M2. You can also use the Asahi installer to create a UEFI boot partition that will allow you to install any operating system. That does not mean it will run. A list of alternative distros can be found here.\n",(0,a.jsx)(n.a,{href:"https://github.com/AsahiLinux/docs/wiki/SW%3AAlternative-Distros",children:"https://github.com/AsahiLinux/docs/wiki/SW%3AAlternative-Distros"})]}),"\n",(0,a.jsx)(n.p,{children:"** This guide is for Asahi Arch Linux. **"}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsx)(n.p,{children:"Be sure to log in and fully update MacOS before starting. Open this guide in the M1 MacOS."})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"Desktop version does not have the default alarm user, the user of your choice is setup on first boot. For ease with this guide choose ada as the username. Else pay attention to username when setting up systemd services."})}),"\n",(0,a.jsx)(n.h3,{id:"start-by-installing-asahi-linux-by-following-the-link-below",children:"Start by installing Asahi Linux by following the link below"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://asahilinux.org/2022/03/asahi-linux-alpha-release/",children:"Asahi Alpha Release Notes"})}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsx)(n.p,{children:"Follow this guide on youtube if you want to delete the partitions the Asahi installer creates."}),(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://www.youtube.com/watch?v=nMnWTq2H-N0",children:"uninstall Asahi"})})]}),"\n",(0,a.jsx)(n.p,{children:"Log in to both alarm and root. Change the passwords."}),"\n",(0,a.jsx)(n.h4,{id:"defaults-alarmalarm--rootroot",children:"Defaults: alarm/alarm & root/root."}),"\n",(0,a.jsx)(n.h3,{id:"update-the-system",children:"Update the system"}),"\n",(0,a.jsx)(n.h3,{id:"log-in-and-change-default-passwords",children:"Log in and change default passwords"}),"\n",(0,a.jsx)(n.p,{children:"Log in as root and update the system."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"pacman -Syu\n"})}),"\n",(0,a.jsx)(n.p,{children:"Start and enable sshd. pw auth is disabled for root, login with alarm user."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"systemctl start sshd.service\nsystemctl enable sshd.service\n"})}),"\n",(0,a.jsx)(n.p,{children:"Install pacman-contrib which includes some useful packages and open the sudoers file with visudo and enable the wheel group."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"pacman -S pacman-contrib sudo git curl wget htop rsync numactl\nsudo EDITOR=nano visudo\n"})}),"\n",(0,a.jsx)(n.p,{children:"Remove the # like below."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ visudo"',children:"## Uncomment to allow members of group wheel to execute any command\n%wheel ALL=(ALL:ALL) ALL\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Add a new user to the wheel group, give it a password."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"useradd -m -G wheel -s /bin/bash ada\npasswd ada\n"})}),"\n",(0,a.jsx)(n.p,{children:"Log out and back in as your new user(ada) with SSH. Test sudo by upgrading the system again."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"ssh ada@<M1 private IP addr>\nsudo pacman -Syu\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"caution",children:(0,a.jsx)(n.p,{children:"Remember to copy your ssh key with ssh-copy-id and disable password authentication in sshd_config."})}),"\n",(0,a.jsx)(n.h2,{id:"bash-completion",children:"Bash completion"}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["The Arch Bash shell is boring. Optionally install ",(0,a.jsx)(n.a,{href:"https://bash-it.readthedocs.io/en/latest/installation/",children:"Bash-it"})," for a fancy shell."]})}),"\n",(0,a.jsx)(n.p,{children:"Add 'complete -cf sudo' to the bottom of .bash_profile and source."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"echo complete -cf sudo >> $\\{%HOME}/.bash_profile; . $HOME/.bash_profile\n"})}),"\n",(0,a.jsx)(n.h2,{id:"locales",children:"Locales"}),"\n",(0,a.jsxs)(n.p,{children:["Generate the ",(0,a.jsx)(n.a,{href:"https://wiki.archlinux.org/title/locale",children:"locales"})," by uncommenting (en_US.UTF-8 UTF-8 for example) and generating."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo nano /etc/locale.gen\nsudo locale-gen\nsudo localectl set-locale LANG=en_US.UTF-8\n"})}),"\n",(0,a.jsx)(n.h2,{id:"time",children:"Time"}),"\n",(0,a.jsx)(n.p,{children:"Set your timezone"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo timedatectl set-timezone America/New_York\n"})}),"\n",(0,a.jsxs)(n.admonition,{type:"caution",children:[(0,a.jsx)(n.p,{children:"No more daylight savings, possible to set RTC to local? Testing, might not want to do this."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo timedatectl set-local-rtc 1\n# set to 0 for UTC\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"chrony",children:"Chrony"}),"\n",(0,a.jsx)(n.p,{children:"While we are messing with time.. Install Chrony and open chrony.conf and replace contents with below (use ctrl+k to cut whole lines)."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo pacman -S chrony\nsudo nano /etc/chrony.conf\n"})}),"\n",(0,a.jsx)(n.p,{children:"Replace contents of the file with below."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/chrony.conf"',children:"pool time.google.com       iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\npool time.euro.apple.com   iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\npool time.apple.com        iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\npool ntp.ubuntu.com        iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\n\n# This directive specify the location of the file containing ID/key pairs for\n# NTP authentication.\nkeyfile /etc/chrony/chrony.keys\n\n# This directive specify the file into which chronyd will store the rate\n# information.\ndriftfile /var/lib/chrony/chrony.drift\n\n# Uncomment the following line to turn logging on.\n#log tracking measurements statistics\n\n# Log files location.\nlogdir /var/log/chrony\n\n# Stop bad estimates upsetting machine clock.\nmaxupdateskew 5.0\n\n# This directive enables kernel synchronisation (every 11 minutes) of the\n# real-time clock. Note that it can\u2019t be used along with the 'rtcfile' directive.\nrtcsync\n\n# Step the system clock instead of slewing it if the adjustment is larger than\n# one second, but only in the first three clock updates.\nmakestep 0.1 -1\n\n# Get TAI-UTC offset and leap seconds from the system tz database\nleapsectz right/UTC\n\n# Serve time even if not synchronized to a time source.\nlocal stratum 10\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"caution",children:(0,a.jsx)(n.p,{children:"Note: systemd-timesyncd.service is in conflict with chronyd, so you need to disable it first if you want to enable chronyd properly."})}),"\n",(0,a.jsx)(n.p,{children:"Disable systemd-timesyncd and enable Chrony"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo systemctl stop systemd-timesyncd.service\nsudo systemctl disable systemd-timesyncd.service\n# enable and start chrony\nsudo systemctl start chronyd.service\nsudo systemctl enable chronyd.service\n"})}),"\n",(0,a.jsx)(n.h2,{id:"packages",children:"Packages"}),"\n",(0,a.jsx)(n.p,{children:"Add the following packages to build and run cardano-node."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo pacman -S --needed base-devel\nsudo pacman -S openssl libtool unzip jq bc xz numactl\n"})}),"\n",(0,a.jsx)(n.h2,{id:"zram-swap",children:"zram swap"}),"\n",(0,a.jsx)(n.p,{children:"Install and create a conf file with following."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo pacman -S zram-generator\nsudo nano /usr/lib/systemd/zram-generator.conf\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You may want to read up on zram. I always set 1.5 times the amount of system ram. ",(0,a.jsx)(n.a,{href:"https://github.com/systemd/zram-generator/blob/main/man/zram-generator.conf.md",children:"github"})," | ",(0,a.jsx)(n.a,{href:"https://haydenjames.io/raspberry-pi-performance-add-zram-kernel-parameters/",children:"Hayden James"})," |\n",(0,a.jsx)(n.a,{href:"https://lists.ubuntu.com/archives/lubuntu-users/2013-October/005831.html",children:"lubuntu mailing list"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title="/usr/lib/systemd/zram-generator.conf"',children:"[zram0]\nzram-size = min(24 * 1024)\n"})}),"\n",(0,a.jsx)(n.p,{children:"This will give you 24gb of zram swap and will absorb the brunt of running the built-in leaderlogs. Reboot and check htop to confirm."}),"\n",(0,a.jsx)(n.h2,{id:"prometheus",children:"Prometheus"}),"\n",(0,a.jsx)(n.p,{children:"Install Prometheus and Prometheus-node-exporter"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo pacman -S prometheus prometheus-node-exporter\n"})}),"\n",(0,a.jsx)(n.h2,{id:"yay-aur-package-manager",children:"Yay AUR package manager"}),"\n",(0,a.jsx)(n.p,{children:"Yay (Yet Another Yogurt) \u2013 An AUR Helper Written in Go for Arch Linux distributions. Automate the usage of the Arch User Repository for searching packages published on the AUR, resolving dependencies, downloading, and building AUR packages."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"mkdir ~/git\ncd ~/git\ngit clone https://aur.archlinux.org/yay.git\ncd yay\nmakepkg -si\n"})}),"\n",(0,a.jsx)(n.h3,{id:"grafana-bin-aur",children:"Grafana-bin AUR"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"yay -S grafana-bin\nsudo systemctl start grafana.service\nsudo systemctl enable grafana.service\n\n"})}),"\n",(0,a.jsx)(n.h2,{id:"static-ip",children:"Static ip"}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"You can also set a static IP on your router if you wish and skip this section."})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://wiki.archlinux.org/title/Systemd-networkd#Wired_adapter_using_a_static_IP",children:"systemd"})}),"\n",(0,a.jsx)(n.p,{children:"Create a network service file, make sure you edit it to your network."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo nano /etc/systemd/network/20-wired.network\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/systemd/network/20-wired.network"',children:"[Match]\nName=enp3s0\n\n[Network]\nAddress=192.168.1.151/24\nGateway=192.168.1.1\nDNS=192.168.1.1\n"})}),"\n",(0,a.jsx)(n.p,{children:"Make sure no other network service is running like netctl, then enable and start the service. If there is a network service running stop and disable it."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo systemctl --type=service\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo systemctl enable systemd-networkd.service\nsudo systemctl start systemd-networkd.service\n"})}),"\n",(0,a.jsx)(n.p,{children:"Disable/stop DHCP."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"\nsudo systemctl stop dhcpcd\nsudo systemctl disable dhcpcd\nsudo reboot\n"})}),"\n",(0,a.jsx)(n.h2,{id:"hostname",children:"Hostname"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://wiki.archlinux.org/title/Network_configuration#Set_the_hostname",children:"Set the Hostname"})}),"\n",(0,a.jsx)(n.p,{children:"Edit /etc/hostname"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo nano /etc/hostname\n"})}),"\n",(0,a.jsx)(n.p,{children:"and /etc/hosts"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo nano /etc/hosts\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/hosts"',children:"127.0.0.1        localhost\n::1              localhost\n127.0.1.1        myhostname\n"})}),"\n",(0,a.jsx)(n.h2,{id:"server-setup",children:"Server setup"}),"\n",(0,a.jsx)(n.p,{children:"Tweak/Harden system to our needs."}),"\n",(0,a.jsx)(n.h2,{id:"sysctl",children:"sysctl"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://wiki.archlinux.org/title/sysctl",children:"sysctl"})}),"\n",(0,a.jsx)(n.p,{children:"Create a file in the sysctl.d directory"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo nano /etc/sysctl.d/98-cardano-node.conf\n"})}),"\n",(0,a.jsx)(n.p,{children:"Add the following."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/sysctl.d/98-cardano-node.conf"',children:"## Asahi Node ##\n\nfs.file-max = 10000000\nfs.nr_open = 10000000\n\n# ignore ICMP redirects\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.default.send_redirects = 0\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.default.accept_redirects = 0\n\nnet.ipv4.icmp_ignore_bogus_error_responses = 1\n\n# disable IPv6\n#net.ipv6.conf.all.disable_ipv6 = 1\n#net.ipv6.conf.default.disable_ipv6 = 1\n\n# block SYN attacks\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 2048\nnet.ipv4.tcp_synack_retries = 3\n#net.ipv4.netfilter.ip_conntrack_tcp_timeout_syn_recv=45\n\n# in progress tasks\nnet.ipv4.tcp_keepalive_time = 240\nnet.ipv4.tcp_keepalive_intvl = 4\nnet.ipv4.tcp_keepalive_probes = 5\n\n# reboot if we run out of memory\nvm.panic_on_oom = 1\nkernel.panic = 10\n"})}),"\n",(0,a.jsx)(n.h3,{id:"disable-the-root-user",children:"Disable the root user"}),"\n",(0,a.jsx)(n.p,{children:"Use sudo to become root."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo passwd -l root\n"})}),"\n",(0,a.jsx)(n.h3,{id:"secure-shared-memory",children:"Secure shared memory"}),"\n",(0,a.jsx)(n.p,{children:"Mount shared memory as read only. Open /etc/fstab."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo nano /etc/fstab\n"})}),"\n",(0,a.jsx)(n.p,{children:"Add this line at the bottom, save & exit."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/fstab"',children:"tmpfs    /run/shm    tmpfs    ro,noexec,nosuid    0 0\n"})}),"\n",(0,a.jsx)(n.h3,{id:"increase-open-file-limit-for-user",children:"Increase open file limit for $USER"}),"\n",(0,a.jsx)(n.p,{children:"Add a couple lines to the bottom of /etc/security/limits.conf"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo bash -c \"echo -e '$\\{%USER} soft nofile 800000\\n$\\{%USER} hard nofile 1048576\\n' >> /etc/security/limits.conf\"\n"})}),"\n",(0,a.jsx)(n.p,{children:"Confirm it was added to the bottom."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cat /etc/security/limits.conf\n"})}),"\n",(0,a.jsx)(n.h2,{id:"environment-setup",children:"Environment setup"}),"\n",(0,a.jsx)(n.admonition,{type:"danger",children:(0,a.jsxs)(n.p,{children:["There is a 500 \u20b3 Registration deposit and another 5 \u20b3 in registration costs to start a pool on mainnet. First time users are strongly recommended to use testnet. You can get tada (test ada) from the testnet faucet. ",(0,a.jsx)(n.a,{href:"https://testnets.cardano.org/en/testnets/cardano/tools/faucet/",children:"tada faucet link"})]})}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsx)(n.p,{children:"It is fairly easy to jump to mainnet when you are ready with the same machine. Only need to update files and folders to mainnet and redo pool creation."})}),"\n",(0,a.jsx)(n.p,{children:"Create the directories for our project and an environment file to hold our variables."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"mkdir -p $\\{%HOME}/.local/bin\nmkdir -p $\\{%HOME}/pool/files\nmkdir -p $\\{%HOME}/pool/scripts\nmkdir -p $\\{%HOME}/pool/logs\nmkdir $\\{%HOME}/git\nmkdir $\\{%HOME}/tmp\ntouch $\\{%HOME}/.adaenv\n"})}),"\n",(0,a.jsx)(n.h3,{id:"create-bash-variables--add-localbin-to-our-path-",children:"Create bash variables & add ~/.local/bin to our $PATH \ud83c\udfc3"}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://askubuntu.com/questions/247738/why-is-etc-profile-not-invoked-for-non-login-shells/247769#247769",children:"Environment Variables in Linux/Unix"}),"."]})}),"\n",(0,a.jsx)(n.admonition,{type:"caution",children:(0,a.jsx)(n.p,{children:"You must reload environment files after updating them. The same goes for cardano-node, changes to the topology or config files require a cardano-service restart."})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"echo . ~/.adaenv >> $\\{%HOME}/.bashrc\ncd .local/bin; echo \"export PATH=\\\"$PWD:\\$PATH\\\"\" >> $HOME/.adaenv\necho export NODE_HOME=$\\{%HOME}/pool >> $\\{%HOME}/.adaenv\necho export NODE_PORT=3003 >> $\\{%HOME}/.adaenv\necho export NODE_FILES=$\\{%HOME}/pool/files >> $\\{%HOME}/.adaenv\necho export TOPOLOGY='$\\{%NODE_FILES}'/topology.json >> $\\{%HOME}/.adaenv\necho export DB_PATH='$\\{%NODE_HOME}'/db >> $\\{%HOME}/.adaenv\necho export CONFIG='$\\{%NODE_FILES}'/config.json >> $\\{%HOME}/.adaenv\necho export CARDANO_NODE_SOCKET_PATH=\"$\\{%HOME}/pool/db/socket\" >> $\\{%HOME}/.adaenv\nsource $\\{%HOME}/.bashrc; source $\\{%HOME}/.adaenv\n"})}),"\n",(0,a.jsx)(n.h3,{id:"retrieve-node-files",children:"Retrieve node files"}),"\n",(0,a.jsxs)(n.p,{children:["Configuration files for each chain can be downloaded here.\n",(0,a.jsx)(n.a,{href:"https://book.world.dev.cardano.org/environments.html#production-mainnet",children:"https://book.world.dev.cardano.org/environments.html#production-mainnet"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'cd $NODE_FILES\nwget -N https://book.world.dev.cardano.org/environments/mainnet/config.json\nwget -N https://book.world.dev.cardano.org/environments/mainnet/byron-genesis.json\nwget -N https://book.world.dev.cardano.org/environments/mainnet/shelley-genesis.json\nwget -N https://book.world.dev.cardano.org/environments/mainnet/alonzo-genesis.json\nwget -N https://book.world.dev.cardano.org/environments/mainnet/topology.json\nwget -N https://book.world.dev.cardano.org/environments/mainnet/submit-api-config.json\nwget -N https://book.world.dev.cardano.org/environments/mainnet/conway-genesis.json\n\nRun the following to modify config.json and update TraceBlockFetchDecisions to "true" & listen on all interfaces with Prometheus Node Exporter.\n\n```bash title=">_ Terminal"\nsed -i config.json \\\n    -e "s/TraceBlockFetchDecisions\\": false/TraceBlockFetchDecisions\\": true/g" \\\n    -e "s/127.0.0.1/0.0.0.0/g"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"build-libsodium",children:"Build Libsodium"}),"\n",(0,a.jsx)(n.p,{children:"This is IOHK's fork of Libsodium. It is needed for the dynamic build binary of cardano-node."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd; cd git/\ngit clone https://github.com/input-output-hk/libsodium\ncd libsodium\ngit checkout 66f017f1\n./autogen.sh\n./configure\nmake\nsudo make install\n"})}),"\n",(0,a.jsx)(n.p,{children:"Add library path to ldconfig."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'sudo touch /etc/ld.so.conf.d/local.conf \necho "/usr/local/lib" | sudo tee -a /etc/ld.so.conf.d/local.conf \n'})}),"\n",(0,a.jsx)(n.p,{children:"Echo library paths into .bashrc file and source it."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'echo "export LD_LIBRARY_PATH="/usr/local/lib:$LD_LIBRARY_PATH"" >> ~/.bashrc\necho "export PKG_CONFIG_PATH="/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH"" >> ~/.bashrc\n. ~/.bashrc\n'})}),"\n",(0,a.jsx)(n.p,{children:"Update link cache for shared libraries and confirm."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo ldconfig; ldconfig -p | grep libsodium\n"})}),"\n",(0,a.jsx)(n.h2,{id:"build-secp256k1",children:"Build secp256k1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"git clone https://github.com/bitcoin-core/secp256k1.git\ncd secp256k1\ngit checkout ac83be33\n./autogen.sh\n./configure  --enable-module-schnorrsig --enable-experimental\nmake\nsudo make install\n"})}),"\n",(0,a.jsx)(n.p,{children:"Update link cache for shared libraries and confirm."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo ldconfig; ldconfig -p | grep secp256k1\n"})}),"\n",(0,a.jsx)(n.h2,{id:"blst",children:"blst"}),"\n",(0,a.jsx)(n.p,{children:"Needed for 8.3.0-pre and above."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd ~/git\ngit clone https://github.com/supranational/blst\ncd blst\ngit checkout v0.3.10\n./build.sh\nsudo nano /usr/local/lib/pkgconfig/libblst.pc\n"})}),"\n",(0,a.jsx)(n.p,{children:"Add this."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"\nprefix=/usr/local\nexec_prefix=$\\{%prefix}\nlibdir=$\\{%exec_prefix}/lib\nincludedir=$\\{%prefix}/include\n\nName: libblst\nDescription: Multilingual BLS12-381 signature library\nURL: https://github.com/supranational/blst\nVersion: 0.3.10\nCflags: -I$\\{%includedir}\nLibs: -L$\\{%libdir} -lblst\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Copy other files into place."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo cp bindings/blst_aux.h bindings/blst.h bindings/blst.hpp  /usr/local/include/\nsudo cp libblst.a /usr/local/lib\nsudo chmod u=rw,go=r /usr/local/\\{%lib/\\{%libblst.a,pkgconfig/libblst.pc},include/\\{%blst.\\{%h,hpp},blst_aux.h}}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"llvm-1201",children:"LLVM 12.0.1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd ~/git\nwget https://github.com/llvm/llvm-project/releases/download/llvmorg-12.0.1/clang+llvm-12.0.1-aarch64-linux-gnu.tar.xz\ntar -xf clang+llvm-12.0.1-aarch64-linux-gnu.tar.xz\nexport PATH=~/git/clang+llvm-12.0.1-aarch64-linux-gnu/bin/:$PATH\n"})}),"\n",(0,a.jsx)(n.h2,{id:"ncurses5-compat-libs",children:"ncurses5 compat libs"}),"\n",(0,a.jsx)(n.p,{children:"Use N option, ignore aarch64 warning and build it anyways."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"yay -S ncurses5-compat-libs\n"})}),"\n",(0,a.jsx)(n.p,{children:"Confirm."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"clang --version\n"})}),"\n",(0,a.jsx)(n.h2,{id:"ghcup-ghc--cabal",children:"GHCUP, GHC & Cabal"}),"\n",(0,a.jsx)(n.p,{children:"Install ghcup use defaults when asked."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"curl --proto '=https' --tlsv1.2 -sSf https://get-ghcup.haskell.org | sh\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:". ~/.bashrc\nghcup upgrade\nghcup install cabal 3.6.2.0\nghcup set cabal 3.6.2.0\n\nghcup install ghc 8.10.7\nghcup set ghc 8.10.7\n"})}),"\n",(0,a.jsx)(n.p,{children:"Confirm."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cabal --version\nghc --version\n"})}),"\n",(0,a.jsx)(n.h3,{id:"obtain-cardano-node",children:"Obtain cardano-node"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd $HOME/git\ngit clone https://github.com/input-output-hk/cardano-node.git\ncd cardano-node\ngit fetch --all --recurse-submodules --tags\ngit checkout $(curl -s https://api.github.com/repos/input-output-hk/cardano-node/releases/latest | jq -r .tag_name)\n"})}),"\n",(0,a.jsx)(n.p,{children:"Configure with 8.10.7 & set libsodium"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'cabal update\ncabal configure -O0 -w ghc-8.10.7\n\necho -e "package cardano-crypto-praos\\n flags: -external-libsodium-vrf" > cabal.project.local\nsed -i $HOME/.cabal/config -e "s/overwrite-policy:/overwrite-policy: always/g"\nrm -rf dist-newstyle/build/aarch64-linux/ghc-8.10.7\n'})}),"\n",(0,a.jsx)(n.p,{children:"Build cardano-cli cardano-node."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cabal build cardano-cli cardano-node\n"})}),"\n",(0,a.jsx)(n.p,{children:"Add them to your PATH."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'cp $(find $HOME/git/cardano-node/dist-newstyle/build -type f -name "cardano-cli") $HOME/.local/bin/\ncp $(find $HOME/git/cardano-node/dist-newstyle/build -type f -name "cardano-node") $HOME/.local/bin/\n'})}),"\n",(0,a.jsx)(n.p,{children:"Check"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cardano-node version\ncardano-cli version\n"})}),"\n",(0,a.jsx)(n.h3,{id:"systemd-unit-startup-scripts",children:"Systemd unit startup scripts"}),"\n",(0,a.jsx)(n.p,{children:"Create the startup script and systemd unit file so systemd can manage cardano-node."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"nano $\\{%HOME}/.local/bin/cardano-service\n"})}),"\n",(0,a.jsx)(n.p,{children:"Edit the username here if you chose to not use ada. Paste the following, save & exit."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title="${%HOME}/.local/bin/cardano-service"',children:"#!/bin/bash\n. /home/ada/.adaenv\n\n## +RTS -N6 -RTS = Multicore(4)\ncardano-node run +RTS -N6 -RTS \\\n  --topology $\\{%TOPOLOGY} \\\n  --database-path $\\{%DB_PATH} \\\n  --socket-path $\\{%CARDANO_NODE_SOCKET_PATH} \\\n  --port $\\{%NODE_PORT} \\\n  --config $\\{%CONFIG}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Allow execution of our new cardano-node startup script."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"chmod +x $\\{%HOME}/.local/bin/cardano-service\n"})}),"\n",(0,a.jsx)(n.p,{children:"Open /etc/systemd/system/cardano-node.service."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo nano /etc/systemd/system/cardano-node.service\n"})}),"\n",(0,a.jsx)(n.p,{children:"Paste the following, You will need to edit the username here if you chose to not use ada. Save & exit."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/systemd/system/cardano-node.service"',children:'# The Cardano Node Service (part of systemd)\n# file: /etc/systemd/system/cardano-node.service\n\n[Unit]\nDescription     = Cardano node service\nWants           = network-online.target\nAfter           = network-online.target\n\n[Service]\nUser            = ada\nType            = simple\nWorkingDirectory= /home/ada/pool\nExecStart       = /bin/bash -c "PATH=/home/ada/.local/bin:$PATH exec /home/ada/.local/bin/cardano-service"\nKillSignal=SIGINT\nRestartKillSignal=SIGINT\nTimeoutStopSec=10\nLimitNOFILE=32768\nRestart=always\nRestartSec=10\nEnvironmentFile=-/home/ada/.adaenv\n\n[Install]\nWantedBy= multi-user.target\n'})}),"\n",(0,a.jsx)(n.p,{children:"Reload systemd so it picks up our new service files."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo systemctl daemon-reload\n"})}),"\n",(0,a.jsx)(n.p,{children:"Let's add a couple functions to the bottom of our .adaenv file to make life a little easier."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"nano $\\{%HOME}/.adaenv\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title="${%HOME}/.adaenv"',children:'cardano-service() \\{%\n    #do things with parameters like $1 such as\n    sudo systemctl "$1" cardano-node.service\n}\n\ncardano-monitor() \\{%\n    #do things with parameters like $1 such as\n    sudo systemctl "$1" prometheus.service\n    sudo systemctl "$1" prometheus-node-exporter.service\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Source these changes into your surrent shell."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"source $\\{%HOME}/.adaenv\n"})}),"\n",(0,a.jsx)(n.p,{children:"What we just did there was added a couple functions to control our cardano-service and cardano-submit without having to type out"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"sudo systemctl enable cardano-node.service"}),"\n",(0,a.jsx)(n.p,{children:"sudo systemctl start cardano-node.service"}),"\n",(0,a.jsx)(n.p,{children:"sudo systemctl stop cardano-node.service"}),"\n",(0,a.jsx)(n.p,{children:"sudo systemctl status cardano-node.service"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Now we just have to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"cardano-service enable (enables cardano-node.service auto start at boot)"}),"\n",(0,a.jsx)(n.li,{children:"cardano-service start (starts cardano-node.service)"}),"\n",(0,a.jsx)(n.li,{children:"cardano-service stop (stops cardano-node.service)"}),"\n",(0,a.jsx)(n.li,{children:"cardano-service status (shows the status of cardano-node.service)"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"gliveviewsh",children:"gLiveView.sh"}),"\n",(0,a.jsx)(n.p,{children:"Guild operators scripts has a couple useful tools for operating a pool. We do not want the project as a whole, though there are a couple scripts we are going to use."}),"\n",(0,a.jsxs)(n.p,{children:['{%% embed url="',(0,a.jsx)(n.a,{href:"https://github.com/cardano-community/guild-operators/tree/master/scripts/cnode-helper-scripts",children:"https://github.com/cardano-community/guild-operators/tree/master/scripts/cnode-helper-scripts"}),'" %}']}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"cd $NODE_HOME/scripts\nwget https://raw.githubusercontent.com/cardano-community/guild-operators/master/scripts/cnode-helper-scripts/env\nwget https://raw.githubusercontent.com/cardano-community/guild-operators/master/scripts/cnode-helper-scripts/gLiveView.sh\n"})}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsx)(n.p,{children:"You can change the port cardano-node runs on in the .adaenv file in your home directory. Open the file edit the port number. Load the change into your shell & restart the cardano-node service."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"nano $\\{%HOME}/.adaenv\nsource $\\{%HOME}/.adaenv\ncardano-service restart\n"})})]}),"\n",(0,a.jsx)(n.p,{children:"Add a line sourcing our .adaenv file to the top of the env file and adjust some paths."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'sed -i env \\\n    -e "/#CNODEBIN/i. $\\{%HOME}/.adaenv" \\\n    -e "s/\\#CNODE_HOME=\\"\\/opt\\/cardano\\/cnode\\"/CNODE_HOME=\\"\\$\\{%HOME}\\/pool\\"/g" \\\n    -e "s/\\#CNODE_PORT=6000"/CNODE_PORT=\\"\'$\\{%NODE_PORT}\'\\""/g" \\\n    -e "s/\\#CONFIG=\\"\\$\\{%CNODE_HOME}\\/files\\/config.json\\"/CONFIG=\\"\\$\\{%NODE_FILES}\\/config.json\\"/g" \\\n    -e "s/\\#TOPOLOGY=\\"\\$\\{%CNODE_HOME}\\/files\\/topology.json\\"/TOPOLOGY=\\"\\$\\{%NODE_FILES}\\/topology.json\\"/g" \\\n    -e "s/\\#LOG_DIR=\\"\\$\\{%CNODE_HOME}\\/logs\\"/LOG_DIR=\\"\\$\\{%CNODE_HOME}\\/logs\\"/g"\n'})}),"\n",(0,a.jsx)(n.p,{children:"Allow execution of gLiveView.sh."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"chmod +x gLiveView.sh\n"})}),"\n",(0,a.jsx)(n.h2,{id:"install-cronie",children:"Install Cronie"}),"\n",(0,a.jsx)(n.p,{children:"Arch does not use cron. You can set up a systemd timer or install some other cron like scheduler."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"sudo pacman -S cronie\n"})}),"\n",(0,a.jsx)(n.p,{children:"Enable & start."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo systemctl enable cronie.service\nsudo systemctl start cronie.service\n"})}),"\n",(0,a.jsx)(n.h2,{id:"topologyupdatersh-not-needed-on-block-producer",children:"topologyUpdater.sh (not needed on block producer)"}),"\n",(0,a.jsx)(n.p,{children:"Until peer to peer is enabled on the network operators need a way to get a list of relays/peers to connect to. The topology updater service runs in the background with cron. Every hour the script will run and tell the service you are a relay and want to be a part of the network. It will add your relay to it's directory after four hours you should see in connections in gLiveView."}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"The list generated will show you the distance & a clue as to where the relay is located."})}),"\n",(0,a.jsx)(n.p,{children:"Download the topologyUpdater script and have a look at it. Here is where you will enter your block producer or any other custom peers you would like to always be connected to."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"wget https://raw.githubusercontent.com/cardano-community/guild-operators/master/scripts/cnode-helper-scripts/topologyUpdater.sh\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"nano topologyUpdater.sh\n"})}),"\n",(0,a.jsx)(n.p,{children:"Save, exit and make it executable."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"chmod +x topologyUpdater.sh\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"You will not be able to successfully execute ./topologyUpdater.sh until you are fully synced up to the tip of the chain."})}),"\n",(0,a.jsx)(n.p,{children:"Create a cron job that will run once an hour."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"EDITOR=nano crontab -e\n"})}),"\n",(0,a.jsx)(n.h3,{id:"add-save-and-exit",children:"Add save and exit"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"SHELL=/bin/bash\n33 * * * * . $HOME/.adaenv; $HOME/pool/scripts/topologyUpdater.sh\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"nano $NODE_FILES/topology.json\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"You can use gLiveView.sh to view ping times in relation to the peers in your topology file. Use ping to resolve hostnames to IP's."})}),"\n",(0,a.jsx)(n.p,{children:"Changes to this file will take affect upon restarting the cardano-service."}),"\n",(0,a.jsx)(n.h2,{id:"display-inbound-connections-in-grafana",children:"Display inbound connections in Grafana"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"mkdir -p $HOME/custom-metrics/tmp\nnano $HOME/custom-metrics/peers_in.sh\n"})}),"\n",(0,a.jsx)(n.p,{children:"Add following, update port # to match cardano-node port."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'INCOMING_PEERS="$(ss -tnp state established | grep "cardano-node" | awk -v port=":3003" \'$3 ~ port \\{%print}\' | wc -l)"\necho "peers_in $\\{%INCOMING_PEERS}" > /home/ada/custom-metrics/tmp/peers_in.prom.tmp\nmv /home/ada/custom-metrics/tmp/peers_in.prom.tmp /var/lib/node_exporter/peers_in.prom\n'})}),"\n",(0,a.jsx)(n.p,{children:"Make it executable."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"chmod +x $HOME/custom-metrics/peers_in.sh\n"})}),"\n",(0,a.jsx)(n.p,{children:"Open node-exporter configuration file and add.."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo nano /etc/conf.d/prometheus-node-exporter\n"})}),"\n",(0,a.jsx)(n.p,{children:"Make it look like this."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"NODE_EXPORTER_ARGS='--collector.textfile.directory=/var/lib/node_exporter'\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create that directory."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo mkdir /var/lib/node_exporter\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create a cron job as root to run our script every minute."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo EDITOR=nano crontab -e\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"SHELL=/bin/bash\n* * * * * /home/ada/custom-metrics/peers_in.sh\n"})}),"\n",(0,a.jsx)(n.p,{children:"Restart prometheus-node-exporter."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo systemctl restart prometheus-node-exporter\n"})}),"\n",(0,a.jsx)(n.p,{children:"After a minute you should be able to find a metric in Grafana called 'peers_in'."}),"\n",(0,a.jsx)(n.h2,{id:"system-updates",children:"System updates"}),"\n",(0,a.jsx)(n.p,{children:"View available system upgrades(pacman) on Grafana"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"nano $HOME/custom-metrics/pacman_upgrades.sh\n"})}),"\n",(0,a.jsx)(n.p,{children:"Add following. Replace ada with your username here if different."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:'UPDATES="$(/usr/bin/checkupdates | wc -l)"\necho "pacman_upgrades_pending $\\{%UPDATES}" > /home/ada/custom-metrics/tmp/pacman_upgrades_pending.prom.tmp\nmv /home/ada/custom-metrics/tmp/pacman_upgrades_pending.prom.tmp /var/lib/node_exporter/pacman_upgrades_pending.prom\n'})}),"\n",(0,a.jsx)(n.p,{children:"Make it executable."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"chmod +x $HOME/custom-metrics/pacman_upgrades.sh\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create a cron job as root to run our script once a day at 1 am."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo EDITOR=nano crontab -e\n"})}),"\n",(0,a.jsx)(n.p,{children:"Replace ada with your username here if different."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"0 1 * * * /home/ada/custom-metrics/pacman_upgrades.sh\n"})}),"\n",(0,a.jsx)(n.p,{children:"Restart prometheus-node-exporter."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo systemctl restart prometheus-node-exporter\n"})}),"\n",(0,a.jsx)(n.p,{children:"In Grafana find the 'pacman_upgrades_pending' metric. It will not be available until you fire off the script or cron runs it."}),"\n",(0,a.jsx)(n.h2,{id:"firewall",children:"Firewall"}),"\n",(0,a.jsx)(n.p,{children:"Install UFW"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo pacman -S ufw\n"})}),"\n",(0,a.jsx)(n.h2,{id:"wireless",children:"Wireless"}),"\n",(0,a.jsx)(n.p,{children:"Connect with wireless"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:'title=">_ Terminal"',children:"sudo pacman -S dialog wpa_supplicant\nsudo wifi-menu -o\n"})}),"\n",(0,a.jsx)(n.h2,{id:"usefull-links",children:"Usefull links"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://nsrc.org/workshops/2021/sanog37/nmm/netmgmt/en/prometheus/ex-custom-metrics.htm",children:"custom-metrics"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://vdwaa.nl/arch-prometheus-monitoring.html",children:"arch prometheus monitoring"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var a=s(6540);const t={},i=a.createContext(t);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);